[2025-07-13 23:26:19][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:26:19][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:26:19][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00019s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00043s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00010s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 26, 19, 642852), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 26, 19, 642855), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 26, 19, 648334)}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00022s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'question_id__0': 1, 'choice_id__0': 2, 'user_id__0': '1', 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 26, 19, 133536), 'custom_input__0': None, 'question_id__1': 2, 'choice_id__1': 8, 'user_id__1': '1', 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 26, 19, 133558), 'custom_input__1': None, 'question_id__2': 3, 'choice_id__2': 13, 'user_id__2': '1', 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 26, 19, 133566), 'custom_input__2': None, 'question_id__3': 4, 'choice_id__3': 21, 'user_id__3': '1', 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 26, 19, 133573), 'custom_input__3': None, 'question_id__4': 5, 'choice_id__4': 26, 'user_id__4': '1', 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 26, 19, 133580), 'custom_input__4': None, 'question_id__5': 1, 'choice_id__5': 1, 'user_id__5': '2', 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 26, 19, 133586), 'custom_input__5': None, 'question_id__6': 2, 'choice_id__6': 9, 'user_id__6': '2', 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 26, 19, 133592), 'custom_input__6': None, 'question_id__7': 3, 'choice_id__7': 16, 'user_id__7': '2', 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 26, 19, 133598), 'custom_input__7': None, 'question_id__8': 4, 'choice_id__8': 20, 'user_id__8': '2', 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 26, 19, 133604), 'custom_input__8': None, 'question_id__9': 5, 'choice_id__9': 25, 'user_id__9': '2', 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 26, 19, 133610), 'custom_input__9': None}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__0': '1', 'emotion__0': '고마움', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__1': '1', 'emotion__1': '기대감', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__2': '1', 'emotion__2': '미안함', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__3': '1', 'emotion__3': '죄책감', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__4': '1', 'emotion__4': '사랑', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__5': '1', 'emotion__5': '다정함', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__6': '1', 'emotion__6': '친밀감', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__7': '1', 'emotion__7': '억울함', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__8': '1', 'emotion__8': '서운함', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__9': '1', 'emotion__9': '행복', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__10': '1', 'emotion__10': '감사', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__11': '1', 'emotion__11': '신뢰', 'memo__12': '너에 대한 애정이 넘쳤어.', 'date__12': datetime.datetime(2025, 7, 7, 0, 0) ... 8 parameters truncated ... 'user_id__14': '2', 'emotion__14': '바쁨', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__15': '2', 'emotion__15': '서운함', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__16': '2', 'emotion__16': '실망감', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__17': '2', 'emotion__17': '이해', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__18': '2', 'emotion__18': '다정함', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__19': '2', 'emotion__19': '호감', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__20': '2', 'emotion__20': '편안함', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__21': '2', 'emotion__21': '기대감', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__22': '2', 'emotion__22': '불만', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__23': '2', 'emotion__23': '기쁨', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__24': '2', 'emotion__24': '감동', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__25': '2', 'emotion__25': '사랑', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__26': '2', 'emotion__26': '안정감'}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'couple_id__0': '1', 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'deleted_at__0': None, 'user_id__0': '1', 'is_delivered__0': 1, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'embed_index__0': None, 'has_image__0': 0, 'image_url__0': None, 'couple_id__1': '1', 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'deleted_at__1': None, 'user_id__1': '2', 'is_delivered__1': 1, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'embed_index__1': None, 'has_image__1': 0, 'image_url__1': None, 'couple_id__2': '1', 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'deleted_at__2': None, 'user_id__2': '1', 'is_delivered__2': 1, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'embed_index__2': None, 'has_image__2': 0, 'image_url__2': None, 'couple_id__3': '1', 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'deleted_at__3': None, 'user_id__3': '2', 'is_delivered__3': 1, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'embed_index__3': None, 'has_image__3': 0, 'image_url__3': None, 'couple_id__4': '1', 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'deleted_at__4': None, 'user_id__4': '2', 'is_delivered__4': 1, 'content__4': '어제 약속했는데 통화 못했네 😕', 'embed_index__4': None, 'has_image__4': 0, 'image_url__4': None, 'couple_id__5': '1', 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40), 'deleted_at__5': None, 'user_id__5': '1', 'is_delivered__5': 1 ... 170 parameters truncated ... 'is_delivered__24': 1, 'content__24': '너랑 시간 보내는 거 제일 좋아', 'embed_index__24': None, 'has_image__24': 0, 'image_url__24': None, 'couple_id__25': '1', 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'deleted_at__25': None, 'user_id__25': '2', 'is_delivered__25': 1, 'content__25': '나도야~ 🥰', 'embed_index__25': None, 'has_image__25': 0, 'image_url__25': None, 'couple_id__26': '1', 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'deleted_at__26': None, 'user_id__26': '1', 'is_delivered__26': 1, 'content__26': '일주일 진짜 빠르다', 'embed_index__26': None, 'has_image__26': 0, 'image_url__26': None, 'couple_id__27': '1', 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'deleted_at__27': None, 'user_id__27': '2', 'is_delivered__27': 1, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'embed_index__27': None, 'has_image__27': 0, 'image_url__27': None, 'couple_id__28': '1', 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'deleted_at__28': None, 'user_id__28': '1', 'is_delivered__28': 1, 'content__28': '너 있어서 든든했어', 'embed_index__28': None, 'has_image__28': 0, 'image_url__28': None, 'couple_id__29': '1', 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'deleted_at__29': None, 'user_id__29': '2', 'is_delivered__29': 1, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'embed_index__29': None, 'has_image__29': 0, 'image_url__29': None}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:26:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '안녕', 'created_at': datetime.datetime(2025, 7, 13, 14, 26, 28, 204485), 'embed_index': None}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'pk_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {'user_id_1': '2'}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [generated in 0.00022s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT users.user_id AS users_user_id, users.name AS users_name, users.email AS users_email, users.created_at AS users_created_at, users.deleted_at AS users_deleted_at, users.modified_at AS users_modified_at, users.birth AS users_birth, users.gender AS users_gender 
FROM users 
WHERE users.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [cached since 0.008126s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [cached since 0.009876s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=3
[2025-07-13 23:26:28][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:26:28][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [cached since 0.716s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '안녕하세요, 수아! 오늘은 어떤 이야기를 나눌까요? 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 26, 28, 920613), 'embed_index': None}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [cached since 0.7205s ago] {'pk_1': 2}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [cached since 0.7201s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [cached since 0.7226s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [cached since 0.7238s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] [cached since 0.7241s ago] {'user_id_1': '2'}
[2025-07-13 23:26:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:11][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:28:11][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:28:11][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00010s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00033s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00024s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:28:11][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 28, 12, 9553), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 28, 12, 9556), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 28, 12, 15211)}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'custom_input__0': None, 'user_id__0': '1', 'question_id__0': 1, 'choice_id__0': 2, 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 28, 11, 492570), 'custom_input__1': None, 'user_id__1': '1', 'question_id__1': 2, 'choice_id__1': 8, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 28, 11, 492586), 'custom_input__2': None, 'user_id__2': '1', 'question_id__2': 3, 'choice_id__2': 13, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 28, 11, 492594), 'custom_input__3': None, 'user_id__3': '1', 'question_id__3': 4, 'choice_id__3': 21, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 28, 11, 492602), 'custom_input__4': None, 'user_id__4': '1', 'question_id__4': 5, 'choice_id__4': 26, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 28, 11, 492609), 'custom_input__5': None, 'user_id__5': '2', 'question_id__5': 1, 'choice_id__5': 1, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 28, 11, 492615), 'custom_input__6': None, 'user_id__6': '2', 'question_id__6': 2, 'choice_id__6': 9, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 28, 11, 492620), 'custom_input__7': None, 'user_id__7': '2', 'question_id__7': 3, 'choice_id__7': 16, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 28, 11, 492626), 'custom_input__8': None, 'user_id__8': '2', 'question_id__8': 4, 'choice_id__8': 20, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 28, 11, 492632), 'custom_input__9': None, 'user_id__9': '2', 'question_id__9': 5, 'choice_id__9': 25, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 28, 11, 492638)}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__0': '고마움', 'user_id__0': '1', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'user_id__1': '1', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__2': '미안함', 'user_id__2': '1', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'user_id__3': '1', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__4': '사랑', 'user_id__4': '1', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'user_id__5': '1', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__6': '친밀감', 'user_id__6': '1', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__7': '억울함', 'user_id__7': '1', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'user_id__8': '1', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__9': '행복', 'user_id__9': '1', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'user_id__10': '1', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__11': '신뢰', 'user_id__11': '1', 'memo__12': '너에 대한 애정이 넘쳤어.', 'date__12': datetime.datetime(2025, 7, 7, 0, 0) ... 8 parameters truncated ... 'emotion__14': '바쁨', 'user_id__14': '2', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__15': '서운함', 'user_id__15': '2', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'user_id__16': '2', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__17': '이해', 'user_id__17': '2', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'user_id__18': '2', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__19': '호감', 'user_id__19': '2', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'user_id__20': '2', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__21': '기대감', 'user_id__21': '2', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'user_id__22': '2', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__23': '기쁨', 'user_id__23': '2', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'user_id__24': '2', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__25': '사랑', 'user_id__25': '2', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감', 'user_id__26': '2'}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s (insertmanyvalues) 1/1 (ordered)] {'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'embed_index__0': None, 'is_delivered__0': 1, 'user_id__0': '1', 'image_url__0': None, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'has_image__0': 0, 'couple_id__0': '1', 'deleted_at__0': None, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'embed_index__1': None, 'is_delivered__1': 1, 'user_id__1': '2', 'image_url__1': None, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'has_image__1': 0, 'couple_id__1': '1', 'deleted_at__1': None, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'embed_index__2': None, 'is_delivered__2': 1, 'user_id__2': '1', 'image_url__2': None, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'has_image__2': 0, 'couple_id__2': '1', 'deleted_at__2': None, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'embed_index__3': None, 'is_delivered__3': 1, 'user_id__3': '2', 'image_url__3': None, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'has_image__3': 0, 'couple_id__3': '1', 'deleted_at__3': None, 'content__4': '어제 약속했는데 통화 못했네 😕', 'embed_index__4': None, 'is_delivered__4': 1, 'user_id__4': '2', 'image_url__4': None, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'has_image__4': 0, 'couple_id__4': '1', 'deleted_at__4': None, 'content__5': '미안… 회의 끝나고 뻗어버렸어 ㅠ', 'embed_index__5': None, 'is_delivered__5': 1, 'user_id__5': '1', 'image_url__5': None ... 170 parameters truncated ... 'image_url__24': None, 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'has_image__24': 0, 'couple_id__24': '1', 'deleted_at__24': None, 'content__25': '나도야~ 🥰', 'embed_index__25': None, 'is_delivered__25': 1, 'user_id__25': '2', 'image_url__25': None, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'has_image__25': 0, 'couple_id__25': '1', 'deleted_at__25': None, 'content__26': '일주일 진짜 빠르다', 'embed_index__26': None, 'is_delivered__26': 1, 'user_id__26': '1', 'image_url__26': None, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'has_image__26': 0, 'couple_id__26': '1', 'deleted_at__26': None, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'embed_index__27': None, 'is_delivered__27': 1, 'user_id__27': '2', 'image_url__27': None, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'has_image__27': 0, 'couple_id__27': '1', 'deleted_at__27': None, 'content__28': '너 있어서 든든했어', 'embed_index__28': None, 'is_delivered__28': 1, 'user_id__28': '1', 'image_url__28': None, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'has_image__28': 0, 'couple_id__28': '1', 'deleted_at__28': None, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'embed_index__29': None, 'is_delivered__29': 1, 'user_id__29': '2', 'image_url__29': None, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'has_image__29': 0, 'couple_id__29': '1', 'deleted_at__29': None}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:28:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:22][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.user_1 = %(user_1_1)s OR couples.user_2 = %(user_2_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:28:22][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'user_1_1': '2', 'user_2_1': '2', 'param_1': 1}
[2025-07-13 23:28:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:22][INFO][sqlalchemy.engine.Engine] SELECT messages.chat_id AS messages_chat_id, messages.user_id AS messages_user_id, messages.couple_id AS messages_couple_id, messages.content AS messages_content, messages.image_url AS messages_image_url, messages.has_image AS messages_has_image, messages.created_at AS messages_created_at, messages.deleted_at AS messages_deleted_at, messages.is_delivered AS messages_is_delivered, messages.embed_index AS messages_embed_index 
FROM messages 
WHERE messages.couple_id = %(couple_id_1)s AND messages.user_id = %(user_id_1)s AND messages.is_delivered = false ORDER BY messages.created_at
[2025-07-13 23:28:22][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'couple_id_1': '1', 'user_id_1': '1'}
[2025-07-13 23:28:22][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:55][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '안녕', 'created_at': datetime.datetime(2025, 7, 13, 14, 29, 55, 676585), 'embed_index': None}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'pk_1': 1}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] {'user_id_1': '2'}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] SELECT users.user_id AS users_user_id, users.name AS users_name, users.email AS users_email, users.created_at AS users_created_at, users.deleted_at AS users_deleted_at, users.modified_at AS users_modified_at, users.birth AS users_birth, users.gender AS users_gender 
FROM users 
WHERE users.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [cached since 0.006342s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] [cached since 0.007723s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:55][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:55][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=3
[2025-07-13 23:28:26][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:28:26][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] [cached since 0.9168s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '안녕하세요, 수아님! 오늘은 어떤 마음으로 오셨나요? 😊 궁금한 게 있으면 언제든지 말씀해 주세요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 28, 26, 253963), 'embed_index': None}
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] [cached since 0.9186s ago] {'pk_1': 2}
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] [cached since 0.9182s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:26][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] [cached since 0.92s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] [cached since 0.9211s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] [cached since 0.9222s ago] {'user_id_1': '2'}
[2025-07-13 23:28:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] [cached since 17.93s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:43][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] [cached since 17.93s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '남자친구랑 싸웠어', 'created_at': datetime.datetime(2025, 7, 13, 14, 28, 43, 262460), 'embed_index': None}
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] [cached since 17.93s ago] {'pk_1': 3}
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] [cached since 17.93s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] [cached since 17.93s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:28:43][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:43][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=5
[2025-07-13 23:28:44][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:28:44][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] [cached since 19.09s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '어머, 마음이 많이 무거우시겠어요. 어떤 일로 다투셨는지 저에게 조금 나눠주실 수 있을까요? 제가 도와드릴 수 있는 부분이 있을 거예요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 28, 44, 417473), 'embed_index': None}
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] [cached since 19.1s ago] {'pk_1': 4}
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] [cached since 19.1s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:44][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=4
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] [cached since 19.1s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] [cached since 19.1s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] [cached since 19.1s ago] {'user_id_1': '2'}
[2025-07-13 23:28:44][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:11][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:29:11][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:29:11][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [no key 0.00013s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:11][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 29, 12, 164109), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 29, 12, 164112), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 29, 12, 169824)}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00028s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'custom_input__0': None, 'choice_id__0': 2, 'question_id__0': 1, 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 29, 11, 656991), 'user_id__1': '1', 'custom_input__1': None, 'choice_id__1': 8, 'question_id__1': 2, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 29, 11, 657006), 'user_id__2': '1', 'custom_input__2': None, 'choice_id__2': 13, 'question_id__2': 3, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 29, 11, 657014), 'user_id__3': '1', 'custom_input__3': None, 'choice_id__3': 21, 'question_id__3': 4, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 29, 11, 657038), 'user_id__4': '1', 'custom_input__4': None, 'choice_id__4': 26, 'question_id__4': 5, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 29, 11, 657050), 'user_id__5': '2', 'custom_input__5': None, 'choice_id__5': 1, 'question_id__5': 1, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 29, 11, 657057), 'user_id__6': '2', 'custom_input__6': None, 'choice_id__6': 9, 'question_id__6': 2, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 29, 11, 657063), 'user_id__7': '2', 'custom_input__7': None, 'choice_id__7': 16, 'question_id__7': 3, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 29, 11, 657069), 'user_id__8': '2', 'custom_input__8': None, 'choice_id__8': 20, 'question_id__8': 4, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 29, 11, 657075), 'user_id__9': '2', 'custom_input__9': None, 'choice_id__9': 25, 'question_id__9': 5, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 29, 11, 657082)}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__0': '고마움', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'user_id__1': '1', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__2': '1', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__2': '미안함', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'user_id__3': '1', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'user_id__4': '1', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__4': '사랑', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__5': '1', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__6': '1', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__6': '친밀감', 'memo__6': '너와의 대화가 편하고 좋았어.', 'user_id__7': '1', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__7': '억울함', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'user_id__8': '1', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'memo__8': '너의 반응이 조금 서운했어.', 'user_id__9': '1', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__9': '행복', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'user_id__10': '1', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'user_id__11': '1', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__11': '신뢰', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'user_id__12': '1', 'date__12': datetime.datetime(2025, 7, 7, 0, 0) ... 8 parameters truncated ... 'emotion__14': '바쁨', 'memo__14': '서로 바빠도 너를 떠올리게 됐어.', 'user_id__15': '2', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__15': '서운함', 'memo__15': '너의 반응이 조금 서운했어.', 'user_id__16': '2', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'user_id__17': '2', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__17': '이해', 'memo__17': '네 입장에서 생각해보게 됐어.', 'user_id__18': '2', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__19': '2', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__19': '호감', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'user_id__20': '2', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'memo__20': '너와 있으면 참 편안해.', 'user_id__21': '2', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__21': '기대감', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__22': '2', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'user_id__23': '2', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__23': '기쁨', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'user_id__24': '2', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'memo__24': '사소한 행동에도 감동했어.', 'user_id__25': '2', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__25': '사랑', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__26': '2', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.'}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'couple_id__0': '1', 'has_image__0': 0, 'embed_index__0': None, 'image_url__0': None, 'deleted_at__0': None, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'is_delivered__0': 1, 'user_id__1': '2', 'couple_id__1': '1', 'has_image__1': 0, 'embed_index__1': None, 'image_url__1': None, 'deleted_at__1': None, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'is_delivered__1': 1, 'user_id__2': '1', 'couple_id__2': '1', 'has_image__2': 0, 'embed_index__2': None, 'image_url__2': None, 'deleted_at__2': None, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'is_delivered__2': 1, 'user_id__3': '2', 'couple_id__3': '1', 'has_image__3': 0, 'embed_index__3': None, 'image_url__3': None, 'deleted_at__3': None, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'is_delivered__3': 1, 'user_id__4': '2', 'couple_id__4': '1', 'has_image__4': 0, 'embed_index__4': None, 'image_url__4': None, 'deleted_at__4': None, 'content__4': '어제 약속했는데 통화 못했네 😕', 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'is_delivered__4': 1, 'user_id__5': '1', 'couple_id__5': '1', 'has_image__5': 0, 'embed_index__5': None, 'image_url__5': None ... 170 parameters truncated ... 'image_url__24': None, 'deleted_at__24': None, 'content__24': '너랑 시간 보내는 거 제일 좋아', 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'is_delivered__24': 1, 'user_id__25': '2', 'couple_id__25': '1', 'has_image__25': 0, 'embed_index__25': None, 'image_url__25': None, 'deleted_at__25': None, 'content__25': '나도야~ 🥰', 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'is_delivered__25': 1, 'user_id__26': '1', 'couple_id__26': '1', 'has_image__26': 0, 'embed_index__26': None, 'image_url__26': None, 'deleted_at__26': None, 'content__26': '일주일 진짜 빠르다', 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'is_delivered__26': 1, 'user_id__27': '2', 'couple_id__27': '1', 'has_image__27': 0, 'embed_index__27': None, 'image_url__27': None, 'deleted_at__27': None, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'is_delivered__27': 1, 'user_id__28': '1', 'couple_id__28': '1', 'has_image__28': 0, 'embed_index__28': None, 'image_url__28': None, 'deleted_at__28': None, 'content__28': '너 있어서 든든했어', 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'is_delivered__28': 1, 'user_id__29': '2', 'couple_id__29': '1', 'has_image__29': 0, 'embed_index__29': None, 'image_url__29': None, 'deleted_at__29': None, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'is_delivered__29': 1}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:14][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '안녕', 'created_at': datetime.datetime(2025, 7, 13, 14, 29, 14, 730751), 'embed_index': None}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'pk_1': 1}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {'user_id_1': '2'}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] SELECT users.user_id AS users_user_id, users.name AS users_name, users.email AS users_email, users.created_at AS users_created_at, users.deleted_at AS users_deleted_at, users.modified_at AS users_modified_at, users.birth AS users_birth, users.gender AS users_gender 
FROM users 
WHERE users.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [cached since 0.006106s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] [cached since 0.007601s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:14][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=3
[2025-07-13 23:29:15][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:29:15][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] [cached since 1.046s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '안녕하세요, 수아님 :) 어떤 고민이든 함께 나눌 준비가 되어 있어요. 무슨 일이 있었나요?', 'created_at': datetime.datetime(2025, 7, 13, 14, 29, 15, 769653), 'embed_index': None}
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] [cached since 1.049s ago] {'pk_1': 2}
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] [cached since 1.05s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:15][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:15][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] [cached since 16.91s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:31][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] [cached since 16.91s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '남자친구랑 싸웠어..', 'created_at': datetime.datetime(2025, 7, 13, 14, 29, 31, 637260), 'embed_index': None}
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] [cached since 16.91s ago] {'pk_1': 3}
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] [cached since 16.91s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] [cached since 16.91s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:31][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=5
[2025-07-13 23:29:32][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:29:32][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] [cached since 18.24s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '아이고, 마음이 많이 아프시겠어요. 싸운 이유는 뭐였는지 말씀해 주실 수 있나요? 같이 얘기해보면 좀 더 나아질 수도 있지 않을까요?', 'created_at': datetime.datetime(2025, 7, 13, 14, 29, 32, 965162), 'embed_index': None}
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] [cached since 18.24s ago] {'pk_1': 4}
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] [cached since 18.24s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:29:32][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:29:32][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=4
[2025-07-13 23:29:56][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:29:56][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:29:56][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00011s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00023s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:29:56][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00019s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 29, 57, 112516), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 29, 57, 112519), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 29, 57, 117899)}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00021s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 29, 56, 602785), 'custom_input__0': None, 'user_id__0': '1', 'question_id__0': 1, 'choice_id__0': 2, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 29, 56, 602801), 'custom_input__1': None, 'user_id__1': '1', 'question_id__1': 2, 'choice_id__1': 8, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 29, 56, 602808), 'custom_input__2': None, 'user_id__2': '1', 'question_id__2': 3, 'choice_id__2': 13, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 29, 56, 602815), 'custom_input__3': None, 'user_id__3': '1', 'question_id__3': 4, 'choice_id__3': 21, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 29, 56, 602822), 'custom_input__4': None, 'user_id__4': '1', 'question_id__4': 5, 'choice_id__4': 26, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 29, 56, 602830), 'custom_input__5': None, 'user_id__5': '2', 'question_id__5': 1, 'choice_id__5': 1, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 29, 56, 602836), 'custom_input__6': None, 'user_id__6': '2', 'question_id__6': 2, 'choice_id__6': 9, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 29, 56, 602841), 'custom_input__7': None, 'user_id__7': '2', 'question_id__7': 3, 'choice_id__7': 16, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 29, 56, 602848), 'custom_input__8': None, 'user_id__8': '2', 'question_id__8': 4, 'choice_id__8': 20, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 29, 56, 602854), 'custom_input__9': None, 'user_id__9': '2', 'question_id__9': 5, 'choice_id__9': 25}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__0': '고마움', 'user_id__1': '1', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'user_id__2': '1', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__2': '미안함', 'user_id__3': '1', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'user_id__4': '1', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__4': '사랑', 'user_id__5': '1', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'user_id__6': '1', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__6': '친밀감', 'user_id__7': '1', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__7': '억울함', 'user_id__8': '1', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'user_id__9': '1', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__9': '행복', 'user_id__10': '1', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'user_id__11': '1', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__11': '신뢰', 'user_id__12': '1', 'memo__12': '너에 대한 애정이 넘쳤어.' ... 8 parameters truncated ... 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__14': '바쁨', 'user_id__15': '2', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__15': '서운함', 'user_id__16': '2', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'user_id__17': '2', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__17': '이해', 'user_id__18': '2', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'user_id__19': '2', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__19': '호감', 'user_id__20': '2', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'user_id__21': '2', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__21': '기대감', 'user_id__22': '2', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'user_id__23': '2', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__23': '기쁨', 'user_id__24': '2', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'user_id__25': '2', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__25': '사랑', 'user_id__26': '2', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감'}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'is_delivered__0': 1, 'has_image__0': 0, 'user_id__0': '1', 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'embed_index__0': None, 'deleted_at__0': None, 'couple_id__0': '1', 'image_url__0': None, 'is_delivered__1': 1, 'has_image__1': 0, 'user_id__1': '2', 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'embed_index__1': None, 'deleted_at__1': None, 'couple_id__1': '1', 'image_url__1': None, 'is_delivered__2': 1, 'has_image__2': 0, 'user_id__2': '1', 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'embed_index__2': None, 'deleted_at__2': None, 'couple_id__2': '1', 'image_url__2': None, 'is_delivered__3': 1, 'has_image__3': 0, 'user_id__3': '2', 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'embed_index__3': None, 'deleted_at__3': None, 'couple_id__3': '1', 'image_url__3': None, 'is_delivered__4': 1, 'has_image__4': 0, 'user_id__4': '2', 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'content__4': '어제 약속했는데 통화 못했네 😕', 'embed_index__4': None, 'deleted_at__4': None, 'couple_id__4': '1', 'image_url__4': None, 'is_delivered__5': 1, 'has_image__5': 0, 'user_id__5': '1', 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40), 'content__5': '미안… 회의 끝나고 뻗어버렸어 ㅠ' ... 170 parameters truncated ... 'content__24': '너랑 시간 보내는 거 제일 좋아', 'embed_index__24': None, 'deleted_at__24': None, 'couple_id__24': '1', 'image_url__24': None, 'is_delivered__25': 1, 'has_image__25': 0, 'user_id__25': '2', 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'content__25': '나도야~ 🥰', 'embed_index__25': None, 'deleted_at__25': None, 'couple_id__25': '1', 'image_url__25': None, 'is_delivered__26': 1, 'has_image__26': 0, 'user_id__26': '1', 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'content__26': '일주일 진짜 빠르다', 'embed_index__26': None, 'deleted_at__26': None, 'couple_id__26': '1', 'image_url__26': None, 'is_delivered__27': 1, 'has_image__27': 0, 'user_id__27': '2', 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'embed_index__27': None, 'deleted_at__27': None, 'couple_id__27': '1', 'image_url__27': None, 'is_delivered__28': 1, 'has_image__28': 0, 'user_id__28': '1', 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'content__28': '너 있어서 든든했어', 'embed_index__28': None, 'deleted_at__28': None, 'couple_id__28': '1', 'image_url__28': None, 'is_delivered__29': 1, 'has_image__29': 0, 'user_id__29': '2', 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'embed_index__29': None, 'deleted_at__29': None, 'couple_id__29': '1', 'image_url__29': None}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:29:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:46][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:30:46][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:30:46][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [generated in 0.00019s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [generated in 0.00023s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [no key 0.00009s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [no key 0.00030s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:30:46][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [no key 0.00024s] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 30, 47, 169214), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 30, 47, 169217), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 30, 47, 174962)}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'choice_id__0': 2, 'custom_input__0': None, 'question_id__0': 1, 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 30, 46, 649349), 'user_id__0': '1', 'choice_id__1': 8, 'custom_input__1': None, 'question_id__1': 2, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 30, 46, 649370), 'user_id__1': '1', 'choice_id__2': 13, 'custom_input__2': None, 'question_id__2': 3, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 30, 46, 649378), 'user_id__2': '1', 'choice_id__3': 21, 'custom_input__3': None, 'question_id__3': 4, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 30, 46, 649385), 'user_id__3': '1', 'choice_id__4': 26, 'custom_input__4': None, 'question_id__4': 5, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 30, 46, 649392), 'user_id__4': '1', 'choice_id__5': 1, 'custom_input__5': None, 'question_id__5': 1, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 30, 46, 649398), 'user_id__5': '2', 'choice_id__6': 9, 'custom_input__6': None, 'question_id__6': 2, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 30, 46, 649403), 'user_id__6': '2', 'choice_id__7': 16, 'custom_input__7': None, 'question_id__7': 3, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 30, 46, 649408), 'user_id__7': '2', 'choice_id__8': 20, 'custom_input__8': None, 'question_id__8': 4, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 30, 46, 649415), 'user_id__8': '2', 'choice_id__9': 25, 'custom_input__9': None, 'question_id__9': 5, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 30, 46, 649421), 'user_id__9': '2'}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__0': '고마움', 'user_id__0': '1', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'user_id__1': '1', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__2': '미안함', 'user_id__2': '1', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'user_id__3': '1', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__4': '사랑', 'user_id__4': '1', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'user_id__5': '1', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__6': '친밀감', 'user_id__6': '1', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__7': '억울함', 'user_id__7': '1', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'user_id__8': '1', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__9': '행복', 'user_id__9': '1', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'user_id__10': '1', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__11': '신뢰', 'user_id__11': '1', 'memo__12': '너에 대한 애정이 넘쳤어.', 'date__12': datetime.datetime(2025, 7, 7, 0, 0) ... 8 parameters truncated ... 'emotion__14': '바쁨', 'user_id__14': '2', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__15': '서운함', 'user_id__15': '2', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'user_id__16': '2', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__17': '이해', 'user_id__17': '2', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'user_id__18': '2', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__19': '호감', 'user_id__19': '2', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'user_id__20': '2', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__21': '기대감', 'user_id__21': '2', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'user_id__22': '2', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__23': '기쁨', 'user_id__23': '2', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'user_id__24': '2', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__25': '사랑', 'user_id__25': '2', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감', 'user_id__26': '2'}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s (insertmanyvalues) 1/1 (ordered)] {'is_delivered__0': 1, 'deleted_at__0': None, 'image_url__0': None, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'has_image__0': 0, 'embed_index__0': None, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'couple_id__0': '1', 'user_id__0': '1', 'is_delivered__1': 1, 'deleted_at__1': None, 'image_url__1': None, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'has_image__1': 0, 'embed_index__1': None, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'couple_id__1': '1', 'user_id__1': '2', 'is_delivered__2': 1, 'deleted_at__2': None, 'image_url__2': None, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'has_image__2': 0, 'embed_index__2': None, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'couple_id__2': '1', 'user_id__2': '1', 'is_delivered__3': 1, 'deleted_at__3': None, 'image_url__3': None, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'has_image__3': 0, 'embed_index__3': None, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'couple_id__3': '1', 'user_id__3': '2', 'is_delivered__4': 1, 'deleted_at__4': None, 'image_url__4': None, 'content__4': '어제 약속했는데 통화 못했네 😕', 'has_image__4': 0, 'embed_index__4': None, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'couple_id__4': '1', 'user_id__4': '2', 'is_delivered__5': 1, 'deleted_at__5': None, 'image_url__5': None, 'content__5': '미안… 회의 끝나고 뻗어버렸어 ㅠ', 'has_image__5': 0 ... 170 parameters truncated ... 'has_image__24': 0, 'embed_index__24': None, 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'couple_id__24': '1', 'user_id__24': '1', 'is_delivered__25': 1, 'deleted_at__25': None, 'image_url__25': None, 'content__25': '나도야~ 🥰', 'has_image__25': 0, 'embed_index__25': None, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'couple_id__25': '1', 'user_id__25': '2', 'is_delivered__26': 1, 'deleted_at__26': None, 'image_url__26': None, 'content__26': '일주일 진짜 빠르다', 'has_image__26': 0, 'embed_index__26': None, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'couple_id__26': '1', 'user_id__26': '1', 'is_delivered__27': 1, 'deleted_at__27': None, 'image_url__27': None, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'has_image__27': 0, 'embed_index__27': None, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'couple_id__27': '1', 'user_id__27': '2', 'is_delivered__28': 1, 'deleted_at__28': None, 'image_url__28': None, 'content__28': '너 있어서 든든했어', 'has_image__28': 0, 'embed_index__28': None, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'couple_id__28': '1', 'user_id__28': '1', 'is_delivered__29': 1, 'deleted_at__29': None, 'image_url__29': None, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'has_image__29': 0, 'embed_index__29': None, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'couple_id__29': '1', 'user_id__29': '2'}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:30:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:30:59][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:59][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.user_1 = %(user_1_1)s OR couples.user_2 = %(user_2_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:30:59][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'user_1_1': '2', 'user_2_1': '2', 'param_1': 1}
[2025-07-13 23:30:59][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:30:59][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:30:59][INFO][sqlalchemy.engine.Engine] SELECT messages.chat_id AS messages_chat_id, messages.user_id AS messages_user_id, messages.couple_id AS messages_couple_id, messages.content AS messages_content, messages.image_url AS messages_image_url, messages.has_image AS messages_has_image, messages.created_at AS messages_created_at, messages.deleted_at AS messages_deleted_at, messages.is_delivered AS messages_is_delivered, messages.embed_index AS messages_embed_index 
FROM messages 
WHERE messages.couple_id = %(couple_id_1)s AND messages.user_id = %(user_id_1)s AND messages.is_delivered = false ORDER BY messages.created_at
[2025-07-13 23:30:59][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'couple_id_1': '1', 'user_id_1': '1'}
[2025-07-13 23:30:59][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:03][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '안녕', 'created_at': datetime.datetime(2025, 7, 13, 14, 31, 3, 47428), 'embed_index': None}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'pk_1': 1}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id_1': '2'}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] SELECT users.user_id AS users_user_id, users.name AS users_name, users.email AS users_email, users.created_at AS users_created_at, users.deleted_at AS users_deleted_at, users.modified_at AS users_modified_at, users.birth AS users_birth, users.gender AS users_gender 
FROM users 
WHERE users.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [cached since 0.005615s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] [cached since 0.00706s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:03][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=3
[2025-07-13 23:31:04][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:31:04][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] [cached since 1.566s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '안녕하세요, 수아! 어떻게 지내셨나요? 요즘 마음에 걸리는 일이 있다면 편하게 얘기해 주세요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 31, 4, 613884), 'embed_index': None}
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] [cached since 1.57s ago] {'pk_1': 2}
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] [cached since 1.57s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:04][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] [cached since 1.572s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] [cached since 1.573s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] [cached since 1.574s ago] {'user_id_1': '2'}
[2025-07-13 23:31:04][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] [cached since 23.61s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:26][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] [cached since 23.61s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '수아님이라고해야지', 'created_at': datetime.datetime(2025, 7, 13, 14, 31, 26, 654774), 'embed_index': None}
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] [cached since 23.6s ago] {'pk_1': 3}
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] [cached since 23.6s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] [cached since 23.61s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:26][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=5
[2025-07-13 23:31:28][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:31:28][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] [cached since 25.29s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '앗, 미안해요, 수아님! 다음부터는 꼭 기억할게요. 요즘 마음에 걸리는 일이 있으신가요? 말씀해주시면 좋겠어요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 31, 28, 342558), 'embed_index': None}
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] [cached since 25.3s ago] {'pk_1': 4}
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] [cached since 25.3s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:28][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=4
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] [cached since 25.3s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] [cached since 25.3s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] [cached since 25.3s ago] {'user_id_1': '2'}
[2025-07-13 23:31:28][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:02][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:33:02][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:33:02][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00011s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00033s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 2, 910434), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 2, 910437), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 2, 916295)}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'choice_id__0': 2, 'user_id__0': '1', 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 33, 2, 397299), 'custom_input__0': None, 'question_id__0': 1, 'choice_id__1': 8, 'user_id__1': '1', 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 33, 2, 397319), 'custom_input__1': None, 'question_id__1': 2, 'choice_id__2': 13, 'user_id__2': '1', 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 33, 2, 397326), 'custom_input__2': None, 'question_id__2': 3, 'choice_id__3': 21, 'user_id__3': '1', 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 33, 2, 397333), 'custom_input__3': None, 'question_id__3': 4, 'choice_id__4': 26, 'user_id__4': '1', 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 33, 2, 397339), 'custom_input__4': None, 'question_id__4': 5, 'choice_id__5': 1, 'user_id__5': '2', 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 33, 2, 397345), 'custom_input__5': None, 'question_id__5': 1, 'choice_id__6': 9, 'user_id__6': '2', 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 33, 2, 397351), 'custom_input__6': None, 'question_id__6': 2, 'choice_id__7': 16, 'user_id__7': '2', 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 33, 2, 397357), 'custom_input__7': None, 'question_id__7': 3, 'choice_id__8': 20, 'user_id__8': '2', 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 33, 2, 397363), 'custom_input__8': None, 'question_id__8': 4, 'choice_id__9': 25, 'user_id__9': '2', 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 33, 2, 397370), 'custom_input__9': None, 'question_id__9': 5}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'user_id__0': '1', 'emotion__0': '고마움', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__1': '1', 'emotion__1': '기대감', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'user_id__2': '1', 'emotion__2': '미안함', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'user_id__3': '1', 'emotion__3': '죄책감', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__4': '1', 'emotion__4': '사랑', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__5': '1', 'emotion__5': '다정함', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'memo__6': '너와의 대화가 편하고 좋았어.', 'user_id__6': '1', 'emotion__6': '친밀감', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'user_id__7': '1', 'emotion__7': '억울함', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'memo__8': '너의 반응이 조금 서운했어.', 'user_id__8': '1', 'emotion__8': '서운함', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'user_id__9': '1', 'emotion__9': '행복', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'memo__10': '네가 있어줘서 고마운 하루였어.', 'user_id__10': '1', 'emotion__10': '감사', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'user_id__11': '1', 'emotion__11': '신뢰', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'memo__12': '너에 대한 애정이 넘쳤어.', 'user_id__12': '1' ... 8 parameters truncated ... 'emotion__14': '바쁨', 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'memo__15': '너의 반응이 조금 서운했어.', 'user_id__15': '2', 'emotion__15': '서운함', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'user_id__16': '2', 'emotion__16': '실망감', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'memo__17': '네 입장에서 생각해보게 됐어.', 'user_id__17': '2', 'emotion__17': '이해', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__18': '2', 'emotion__18': '다정함', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'memo__19': '너의 말투나 행동이 참 좋았어.', 'user_id__19': '2', 'emotion__19': '호감', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'memo__20': '너와 있으면 참 편안해.', 'user_id__20': '2', 'emotion__20': '편안함', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__21': '2', 'emotion__21': '기대감', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'user_id__22': '2', 'emotion__22': '불만', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'user_id__23': '2', 'emotion__23': '기쁨', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'memo__24': '사소한 행동에도 감동했어.', 'user_id__24': '2', 'emotion__24': '감동', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__25': '2', 'emotion__25': '사랑', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'user_id__26': '2', 'emotion__26': '안정감', 'date__26': datetime.datetime(2025, 7, 7, 0, 0)}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'embed_index__0': None, 'image_url__0': None, 'user_id__0': '1', 'is_delivered__0': 1, 'deleted_at__0': None, 'has_image__0': 0, 'couple_id__0': '1', 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'embed_index__1': None, 'image_url__1': None, 'user_id__1': '2', 'is_delivered__1': 1, 'deleted_at__1': None, 'has_image__1': 0, 'couple_id__1': '1', 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'embed_index__2': None, 'image_url__2': None, 'user_id__2': '1', 'is_delivered__2': 1, 'deleted_at__2': None, 'has_image__2': 0, 'couple_id__2': '1', 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'embed_index__3': None, 'image_url__3': None, 'user_id__3': '2', 'is_delivered__3': 1, 'deleted_at__3': None, 'has_image__3': 0, 'couple_id__3': '1', 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'embed_index__4': None, 'image_url__4': None, 'user_id__4': '2', 'is_delivered__4': 1, 'deleted_at__4': None, 'has_image__4': 0, 'couple_id__4': '1', 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'content__4': '어제 약속했는데 통화 못했네 😕', 'embed_index__5': None, 'image_url__5': None, 'user_id__5': '1', 'is_delivered__5': 1, 'deleted_at__5': None ... 170 parameters truncated ... 'deleted_at__24': None, 'has_image__24': 0, 'couple_id__24': '1', 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'content__24': '너랑 시간 보내는 거 제일 좋아', 'embed_index__25': None, 'image_url__25': None, 'user_id__25': '2', 'is_delivered__25': 1, 'deleted_at__25': None, 'has_image__25': 0, 'couple_id__25': '1', 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'content__25': '나도야~ 🥰', 'embed_index__26': None, 'image_url__26': None, 'user_id__26': '1', 'is_delivered__26': 1, 'deleted_at__26': None, 'has_image__26': 0, 'couple_id__26': '1', 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'content__26': '일주일 진짜 빠르다', 'embed_index__27': None, 'image_url__27': None, 'user_id__27': '2', 'is_delivered__27': 1, 'deleted_at__27': None, 'has_image__27': 0, 'couple_id__27': '1', 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'embed_index__28': None, 'image_url__28': None, 'user_id__28': '1', 'is_delivered__28': 1, 'deleted_at__28': None, 'has_image__28': 0, 'couple_id__28': '1', 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'content__28': '너 있어서 든든했어', 'embed_index__29': None, 'image_url__29': None, 'user_id__29': '2', 'is_delivered__29': 1, 'deleted_at__29': None, 'has_image__29': 0, 'couple_id__29': '1', 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'content__29': '다음 주도 잘 지내보자! 사랑해 😘'}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:09][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '안녕', 'created_at': datetime.datetime(2025, 7, 13, 14, 33, 9, 10759), 'embed_index': None}
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'pk_1': 1}
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] [cached since 0.001492s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:09][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:09][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=7
[2025-07-13 23:33:10][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:33:10][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] [cached since 1.192s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '안녕하세요, 수아님! 오늘은 어떤 이야기를 나누고 싶으신가요? 혹시 마음에 고민이 있으시다면 언제든지 말씀해 주세요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 33, 10, 202737), 'embed_index': None}
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] [cached since 1.196s ago] {'pk_1': 2}
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] [cached since 1.196s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:10][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] [cached since 1.198s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] [cached since 1.199s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] [generated in 0.00009s] {'user_id_1': '2'}
[2025-07-13 23:33:10][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:26][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:33:26][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:33:26][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [generated in 0.00037s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00011s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:33:26][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 27, 111209), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 27, 111211), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 27, 117011)}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00008s (insertmanyvalues) 1/1 (ordered)] {'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 33, 26, 609884), 'question_id__0': 1, 'user_id__0': '1', 'custom_input__0': None, 'choice_id__0': 2, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 33, 26, 609901), 'question_id__1': 2, 'user_id__1': '1', 'custom_input__1': None, 'choice_id__1': 8, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 33, 26, 610013), 'question_id__2': 3, 'user_id__2': '1', 'custom_input__2': None, 'choice_id__2': 13, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 33, 26, 610025), 'question_id__3': 4, 'user_id__3': '1', 'custom_input__3': None, 'choice_id__3': 21, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 33, 26, 610033), 'question_id__4': 5, 'user_id__4': '1', 'custom_input__4': None, 'choice_id__4': 26, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 33, 26, 610040), 'question_id__5': 1, 'user_id__5': '2', 'custom_input__5': None, 'choice_id__5': 1, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 33, 26, 610045), 'question_id__6': 2, 'user_id__6': '2', 'custom_input__6': None, 'choice_id__6': 9, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 33, 26, 610051), 'question_id__7': 3, 'user_id__7': '2', 'custom_input__7': None, 'choice_id__7': 16, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 33, 26, 610057), 'question_id__8': 4, 'user_id__8': '2', 'custom_input__8': None, 'choice_id__8': 20, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 33, 26, 610063), 'question_id__9': 5, 'user_id__9': '2', 'custom_input__9': None, 'choice_id__9': 25}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__0': '1', 'emotion__0': '고마움', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__1': '1', 'emotion__1': '기대감', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__2': '1', 'emotion__2': '미안함', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__3': '1', 'emotion__3': '죄책감', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__4': '1', 'emotion__4': '사랑', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__5': '1', 'emotion__5': '다정함', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__6': '1', 'emotion__6': '친밀감', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__7': '1', 'emotion__7': '억울함', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__8': '1', 'emotion__8': '서운함', 'memo__8': '너의 반응이 조금 서운했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__9': '1', 'emotion__9': '행복', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__10': '1', 'emotion__10': '감사', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__11': '1', 'emotion__11': '신뢰', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__12': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__12': '1' ... 8 parameters truncated ... 'emotion__14': '바쁨', 'memo__14': '서로 바빠도 너를 떠올리게 됐어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__15': '2', 'emotion__15': '서운함', 'memo__15': '너의 반응이 조금 서운했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__16': '2', 'emotion__16': '실망감', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__17': '2', 'emotion__17': '이해', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__18': '2', 'emotion__18': '다정함', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__19': '2', 'emotion__19': '호감', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__20': '2', 'emotion__20': '편안함', 'memo__20': '너와 있으면 참 편안해.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__21': '2', 'emotion__21': '기대감', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__22': '2', 'emotion__22': '불만', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__23': '2', 'emotion__23': '기쁨', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__24': '2', 'emotion__24': '감동', 'memo__24': '사소한 행동에도 감동했어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__25': '2', 'emotion__25': '사랑', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__26': '2', 'emotion__26': '안정감', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.'}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'is_delivered__0': 1, 'has_image__0': 0, 'couple_id__0': '1', 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'user_id__0': '1', 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'embed_index__0': None, 'deleted_at__0': None, 'image_url__0': None, 'is_delivered__1': 1, 'has_image__1': 0, 'couple_id__1': '1', 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'user_id__1': '2', 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'embed_index__1': None, 'deleted_at__1': None, 'image_url__1': None, 'is_delivered__2': 1, 'has_image__2': 0, 'couple_id__2': '1', 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'user_id__2': '1', 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'embed_index__2': None, 'deleted_at__2': None, 'image_url__2': None, 'is_delivered__3': 1, 'has_image__3': 0, 'couple_id__3': '1', 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'user_id__3': '2', 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'embed_index__3': None, 'deleted_at__3': None, 'image_url__3': None, 'is_delivered__4': 1, 'has_image__4': 0, 'couple_id__4': '1', 'content__4': '어제 약속했는데 통화 못했네 😕', 'user_id__4': '2', 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'embed_index__4': None, 'deleted_at__4': None, 'image_url__4': None, 'is_delivered__5': 1, 'has_image__5': 0, 'couple_id__5': '1', 'content__5': '미안… 회의 끝나고 뻗어버렸어 ㅠ', 'user_id__5': '1' ... 170 parameters truncated ... 'user_id__24': '1', 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'embed_index__24': None, 'deleted_at__24': None, 'image_url__24': None, 'is_delivered__25': 1, 'has_image__25': 0, 'couple_id__25': '1', 'content__25': '나도야~ 🥰', 'user_id__25': '2', 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'embed_index__25': None, 'deleted_at__25': None, 'image_url__25': None, 'is_delivered__26': 1, 'has_image__26': 0, 'couple_id__26': '1', 'content__26': '일주일 진짜 빠르다', 'user_id__26': '1', 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'embed_index__26': None, 'deleted_at__26': None, 'image_url__26': None, 'is_delivered__27': 1, 'has_image__27': 0, 'couple_id__27': '1', 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'user_id__27': '2', 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'embed_index__27': None, 'deleted_at__27': None, 'image_url__27': None, 'is_delivered__28': 1, 'has_image__28': 0, 'couple_id__28': '1', 'content__28': '너 있어서 든든했어', 'user_id__28': '1', 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'embed_index__28': None, 'deleted_at__28': None, 'image_url__28': None, 'is_delivered__29': 1, 'has_image__29': 0, 'couple_id__29': '1', 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'user_id__29': '2', 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'embed_index__29': None, 'deleted_at__29': None, 'image_url__29': None}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:31][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '안녕~', 'created_at': datetime.datetime(2025, 7, 13, 14, 33, 31, 906735), 'embed_index': None}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'pk_1': 1}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id_1': '2'}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] SELECT users.user_id AS users_user_id, users.name AS users_name, users.email AS users_email, users.created_at AS users_created_at, users.deleted_at AS users_deleted_at, users.modified_at AS users_modified_at, users.birth AS users_birth, users.gender AS users_gender 
FROM users 
WHERE users.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [cached since 0.005439s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] [cached since 0.007025s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:31][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=3
[2025-07-13 23:33:32][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:33:32][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] [cached since 1.025s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '안녕하세요, 수아! 오늘 기분은 어떠신가요? 궁금한 점이 있으면 언제든지 말씀해 주세요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 33, 32, 931598), 'embed_index': None}
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] [cached since 1.028s ago] {'pk_1': 2}
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] [cached since 1.027s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:32][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] [cached since 1.029s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] [cached since 1.031s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] [cached since 1.031s ago] {'user_id_1': '2'}
[2025-07-13 23:33:32][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:33:46][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:33:46][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:33:46][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:33:46][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00009s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00015s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00022s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 47, 437795), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 47, 437798), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 33, 47, 443543)}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'question_id__0': 1, 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 33, 46, 926348), 'custom_input__0': None, 'choice_id__0': 2, 'user_id__0': '1', 'question_id__1': 2, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 33, 46, 926366), 'custom_input__1': None, 'choice_id__1': 8, 'user_id__1': '1', 'question_id__2': 3, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 33, 46, 926374), 'custom_input__2': None, 'choice_id__2': 13, 'user_id__2': '1', 'question_id__3': 4, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 33, 46, 926381), 'custom_input__3': None, 'choice_id__3': 21, 'user_id__3': '1', 'question_id__4': 5, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 33, 46, 926388), 'custom_input__4': None, 'choice_id__4': 26, 'user_id__4': '1', 'question_id__5': 1, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 33, 46, 926394), 'custom_input__5': None, 'choice_id__5': 1, 'user_id__5': '2', 'question_id__6': 2, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 33, 46, 926401), 'custom_input__6': None, 'choice_id__6': 9, 'user_id__6': '2', 'question_id__7': 3, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 33, 46, 926407), 'custom_input__7': None, 'choice_id__7': 16, 'user_id__7': '2', 'question_id__8': 4, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 33, 46, 926413), 'custom_input__8': None, 'choice_id__8': 20, 'user_id__8': '2', 'question_id__9': 5, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 33, 46, 926420), 'custom_input__9': None, 'choice_id__9': 25, 'user_id__9': '2'}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00007s (insertmanyvalues) 1/1 (ordered)] {'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__0': '고마움', 'user_id__0': '1', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'user_id__1': '1', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__2': '미안함', 'user_id__2': '1', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'user_id__3': '1', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__4': '사랑', 'user_id__4': '1', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'user_id__5': '1', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__6': '친밀감', 'user_id__6': '1', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__7': '억울함', 'user_id__7': '1', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'user_id__8': '1', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__9': '행복', 'user_id__9': '1', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'user_id__10': '1', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__11': '신뢰', 'user_id__11': '1', 'memo__12': '너에 대한 애정이 넘쳤어.', 'date__12': datetime.datetime(2025, 7, 7, 0, 0) ... 8 parameters truncated ... 'emotion__14': '바쁨', 'user_id__14': '2', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__15': '서운함', 'user_id__15': '2', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'user_id__16': '2', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__17': '이해', 'user_id__17': '2', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'user_id__18': '2', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__19': '호감', 'user_id__19': '2', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'user_id__20': '2', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__21': '기대감', 'user_id__21': '2', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'user_id__22': '2', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__23': '기쁨', 'user_id__23': '2', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'user_id__24': '2', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__25': '사랑', 'user_id__25': '2', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감', 'user_id__26': '2'}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'image_url__0': None, 'embed_index__0': None, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'deleted_at__0': None, 'is_delivered__0': 1, 'couple_id__0': '1', 'has_image__0': 0, 'user_id__1': '2', 'image_url__1': None, 'embed_index__1': None, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'deleted_at__1': None, 'is_delivered__1': 1, 'couple_id__1': '1', 'has_image__1': 0, 'user_id__2': '1', 'image_url__2': None, 'embed_index__2': None, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'deleted_at__2': None, 'is_delivered__2': 1, 'couple_id__2': '1', 'has_image__2': 0, 'user_id__3': '2', 'image_url__3': None, 'embed_index__3': None, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'deleted_at__3': None, 'is_delivered__3': 1, 'couple_id__3': '1', 'has_image__3': 0, 'user_id__4': '2', 'image_url__4': None, 'embed_index__4': None, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'content__4': '어제 약속했는데 통화 못했네 😕', 'deleted_at__4': None, 'is_delivered__4': 1, 'couple_id__4': '1', 'has_image__4': 0, 'user_id__5': '1', 'image_url__5': None, 'embed_index__5': None, 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40), 'content__5': '미안… 회의 끝나고 뻗어버렸어 ㅠ' ... 170 parameters truncated ... 'content__24': '너랑 시간 보내는 거 제일 좋아', 'deleted_at__24': None, 'is_delivered__24': 1, 'couple_id__24': '1', 'has_image__24': 0, 'user_id__25': '2', 'image_url__25': None, 'embed_index__25': None, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'content__25': '나도야~ 🥰', 'deleted_at__25': None, 'is_delivered__25': 1, 'couple_id__25': '1', 'has_image__25': 0, 'user_id__26': '1', 'image_url__26': None, 'embed_index__26': None, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'content__26': '일주일 진짜 빠르다', 'deleted_at__26': None, 'is_delivered__26': 1, 'couple_id__26': '1', 'has_image__26': 0, 'user_id__27': '2', 'image_url__27': None, 'embed_index__27': None, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'deleted_at__27': None, 'is_delivered__27': 1, 'couple_id__27': '1', 'has_image__27': 0, 'user_id__28': '1', 'image_url__28': None, 'embed_index__28': None, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'content__28': '너 있어서 든든했어', 'deleted_at__28': None, 'is_delivered__28': 1, 'couple_id__28': '1', 'has_image__28': 0, 'user_id__29': '2', 'image_url__29': None, 'embed_index__29': None, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'deleted_at__29': None, 'is_delivered__29': 1, 'couple_id__29': '1', 'has_image__29': 0}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:33:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:52][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:35:52][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:35:52][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [generated in 0.00022s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00012s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00026s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:35:52][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 35, 53, 62760), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 35, 53, 62763), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 35, 53, 68348)}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00028s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 35, 52, 545509), 'question_id__0': 1, 'choice_id__0': 2, 'custom_input__0': None, 'user_id__0': '1', 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 35, 52, 545524), 'question_id__1': 2, 'choice_id__1': 8, 'custom_input__1': None, 'user_id__1': '1', 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 35, 52, 545531), 'question_id__2': 3, 'choice_id__2': 13, 'custom_input__2': None, 'user_id__2': '1', 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 35, 52, 545538), 'question_id__3': 4, 'choice_id__3': 21, 'custom_input__3': None, 'user_id__3': '1', 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 35, 52, 545545), 'question_id__4': 5, 'choice_id__4': 26, 'custom_input__4': None, 'user_id__4': '1', 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 35, 52, 545551), 'question_id__5': 1, 'choice_id__5': 1, 'custom_input__5': None, 'user_id__5': '2', 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 35, 52, 545556), 'question_id__6': 2, 'choice_id__6': 9, 'custom_input__6': None, 'user_id__6': '2', 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 35, 52, 545562), 'question_id__7': 3, 'choice_id__7': 16, 'custom_input__7': None, 'user_id__7': '2', 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 35, 52, 545568), 'question_id__8': 4, 'choice_id__8': 20, 'custom_input__8': None, 'user_id__8': '2', 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 35, 52, 545574), 'question_id__9': 5, 'choice_id__9': 25, 'custom_input__9': None, 'user_id__9': '2'}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'user_id__0': '1', 'emotion__0': '고마움', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__1': '1', 'emotion__1': '기대감', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'user_id__2': '1', 'emotion__2': '미안함', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'user_id__3': '1', 'emotion__3': '죄책감', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__4': '1', 'emotion__4': '사랑', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__5': '1', 'emotion__5': '다정함', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'memo__6': '너와의 대화가 편하고 좋았어.', 'user_id__6': '1', 'emotion__6': '친밀감', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'user_id__7': '1', 'emotion__7': '억울함', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'memo__8': '너의 반응이 조금 서운했어.', 'user_id__8': '1', 'emotion__8': '서운함', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'user_id__9': '1', 'emotion__9': '행복', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'memo__10': '네가 있어줘서 고마운 하루였어.', 'user_id__10': '1', 'emotion__10': '감사', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'user_id__11': '1', 'emotion__11': '신뢰', 'date__12': datetime.datetime(2025, 7, 7, 0, 0), 'memo__12': '너에 대한 애정이 넘쳤어.' ... 8 parameters truncated ... 'user_id__14': '2', 'emotion__14': '바쁨', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'memo__15': '너의 반응이 조금 서운했어.', 'user_id__15': '2', 'emotion__15': '서운함', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'user_id__16': '2', 'emotion__16': '실망감', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'memo__17': '네 입장에서 생각해보게 됐어.', 'user_id__17': '2', 'emotion__17': '이해', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__18': '2', 'emotion__18': '다정함', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'memo__19': '너의 말투나 행동이 참 좋았어.', 'user_id__19': '2', 'emotion__19': '호감', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'memo__20': '너와 있으면 참 편안해.', 'user_id__20': '2', 'emotion__20': '편안함', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__21': '2', 'emotion__21': '기대감', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'user_id__22': '2', 'emotion__22': '불만', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'user_id__23': '2', 'emotion__23': '기쁨', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'memo__24': '사소한 행동에도 감동했어.', 'user_id__24': '2', 'emotion__24': '감동', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__25': '2', 'emotion__25': '사랑', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'user_id__26': '2', 'emotion__26': '안정감'}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s (insertmanyvalues) 1/1 (ordered)] {'couple_id__0': '1', 'has_image__0': 0, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'deleted_at__0': None, 'embed_index__0': None, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'is_delivered__0': 1, 'user_id__0': '1', 'image_url__0': None, 'couple_id__1': '1', 'has_image__1': 0, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'deleted_at__1': None, 'embed_index__1': None, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'is_delivered__1': 1, 'user_id__1': '2', 'image_url__1': None, 'couple_id__2': '1', 'has_image__2': 0, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'deleted_at__2': None, 'embed_index__2': None, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'is_delivered__2': 1, 'user_id__2': '1', 'image_url__2': None, 'couple_id__3': '1', 'has_image__3': 0, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'deleted_at__3': None, 'embed_index__3': None, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'is_delivered__3': 1, 'user_id__3': '2', 'image_url__3': None, 'couple_id__4': '1', 'has_image__4': 0, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'deleted_at__4': None, 'embed_index__4': None, 'content__4': '어제 약속했는데 통화 못했네 😕', 'is_delivered__4': 1, 'user_id__4': '2', 'image_url__4': None, 'couple_id__5': '1', 'has_image__5': 0, 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40), 'deleted_at__5': None, 'embed_index__5': None ... 170 parameters truncated ... 'embed_index__24': None, 'content__24': '너랑 시간 보내는 거 제일 좋아', 'is_delivered__24': 1, 'user_id__24': '1', 'image_url__24': None, 'couple_id__25': '1', 'has_image__25': 0, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'deleted_at__25': None, 'embed_index__25': None, 'content__25': '나도야~ 🥰', 'is_delivered__25': 1, 'user_id__25': '2', 'image_url__25': None, 'couple_id__26': '1', 'has_image__26': 0, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'deleted_at__26': None, 'embed_index__26': None, 'content__26': '일주일 진짜 빠르다', 'is_delivered__26': 1, 'user_id__26': '1', 'image_url__26': None, 'couple_id__27': '1', 'has_image__27': 0, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'deleted_at__27': None, 'embed_index__27': None, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'is_delivered__27': 1, 'user_id__27': '2', 'image_url__27': None, 'couple_id__28': '1', 'has_image__28': 0, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'deleted_at__28': None, 'embed_index__28': None, 'content__28': '너 있어서 든든했어', 'is_delivered__28': 1, 'user_id__28': '1', 'image_url__28': None, 'couple_id__29': '1', 'has_image__29': 0, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'deleted_at__29': None, 'embed_index__29': None, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'is_delivered__29': 1, 'user_id__29': '2', 'image_url__29': None}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:35:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:02][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '안녕~', 'created_at': datetime.datetime(2025, 7, 13, 14, 36, 2, 385179), 'embed_index': None}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] {'pk_1': 1}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'user_id_1': '2'}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] SELECT users.user_id AS users_user_id, users.name AS users_name, users.email AS users_email, users.created_at AS users_created_at, users.deleted_at AS users_deleted_at, users.modified_at AS users_modified_at, users.birth AS users_birth, users.gender AS users_gender 
FROM users 
WHERE users.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00024s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [cached since 0.006413s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] [cached since 0.00806s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:02][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:02][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=3
[2025-07-13 23:36:03][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:36:03][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] [cached since 1.279s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '안녕하세요, 수아님~ 오늘 기분이 어떠신가요? 궁금한 게 있으시면 언제든지 말씀해 주세요. :)', 'created_at': datetime.datetime(2025, 7, 13, 14, 36, 3, 664236), 'embed_index': None}
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] [cached since 1.282s ago] {'pk_1': 2}
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] [cached since 1.282s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:03][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] [cached since 1.284s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] [cached since 1.285s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] [cached since 1.285s ago] {'user_id_1': '2'}
[2025-07-13 23:36:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:13][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:36:13][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:36:13][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] [generated in 0.00023s] {}
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:36:13][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00011s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 36, 14, 415944), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 36, 14, 415947), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 36, 14, 424377)}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00019s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'choice_id__0': 2, 'user_id__0': '1', 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 36, 13, 898836), 'custom_input__0': None, 'question_id__0': 1, 'choice_id__1': 8, 'user_id__1': '1', 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 36, 13, 898870), 'custom_input__1': None, 'question_id__1': 2, 'choice_id__2': 13, 'user_id__2': '1', 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 36, 13, 898880), 'custom_input__2': None, 'question_id__2': 3, 'choice_id__3': 21, 'user_id__3': '1', 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 36, 13, 898953), 'custom_input__3': None, 'question_id__3': 4, 'choice_id__4': 26, 'user_id__4': '1', 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 36, 13, 898966), 'custom_input__4': None, 'question_id__4': 5, 'choice_id__5': 1, 'user_id__5': '2', 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 36, 13, 898974), 'custom_input__5': None, 'question_id__5': 1, 'choice_id__6': 9, 'user_id__6': '2', 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 36, 13, 898980), 'custom_input__6': None, 'question_id__6': 2, 'choice_id__7': 16, 'user_id__7': '2', 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 36, 13, 898986), 'custom_input__7': None, 'question_id__7': 3, 'choice_id__8': 20, 'user_id__8': '2', 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 36, 13, 898994), 'custom_input__8': None, 'question_id__8': 4, 'choice_id__9': 25, 'user_id__9': '2', 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 36, 13, 899001), 'custom_input__9': None, 'question_id__9': 5}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'emotion__0': '고마움', 'user_id__0': '1', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'user_id__1': '1', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__2': '미안함', 'user_id__2': '1', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'user_id__3': '1', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__4': '사랑', 'user_id__4': '1', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'user_id__5': '1', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__6': '친밀감', 'user_id__6': '1', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__7': '억울함', 'user_id__7': '1', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'user_id__8': '1', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__9': '행복', 'user_id__9': '1', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'user_id__10': '1', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__11': '신뢰', 'user_id__11': '1', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__12': '애정', 'user_id__12': '1' ... 8 parameters truncated ... 'memo__14': '서로 바빠도 너를 떠올리게 됐어.', 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__15': '서운함', 'user_id__15': '2', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'user_id__16': '2', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__17': '이해', 'user_id__17': '2', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'user_id__18': '2', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__19': '호감', 'user_id__19': '2', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'user_id__20': '2', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__21': '기대감', 'user_id__21': '2', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'user_id__22': '2', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__23': '기쁨', 'user_id__23': '2', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'user_id__24': '2', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__25': '사랑', 'user_id__25': '2', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감', 'user_id__26': '2', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0)}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'couple_id__0': '1', 'has_image__0': 0, 'user_id__0': '1', 'is_delivered__0': 1, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'deleted_at__0': None, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'image_url__0': None, 'embed_index__0': None, 'couple_id__1': '1', 'has_image__1': 0, 'user_id__1': '2', 'is_delivered__1': 1, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'deleted_at__1': None, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'image_url__1': None, 'embed_index__1': None, 'couple_id__2': '1', 'has_image__2': 0, 'user_id__2': '1', 'is_delivered__2': 1, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'deleted_at__2': None, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'image_url__2': None, 'embed_index__2': None, 'couple_id__3': '1', 'has_image__3': 0, 'user_id__3': '2', 'is_delivered__3': 1, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'deleted_at__3': None, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'image_url__3': None, 'embed_index__3': None, 'couple_id__4': '1', 'has_image__4': 0, 'user_id__4': '2', 'is_delivered__4': 1, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'deleted_at__4': None, 'content__4': '어제 약속했는데 통화 못했네 😕', 'image_url__4': None, 'embed_index__4': None, 'couple_id__5': '1', 'has_image__5': 0, 'user_id__5': '1', 'is_delivered__5': 1, 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40) ... 170 parameters truncated ... 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'deleted_at__24': None, 'content__24': '너랑 시간 보내는 거 제일 좋아', 'image_url__24': None, 'embed_index__24': None, 'couple_id__25': '1', 'has_image__25': 0, 'user_id__25': '2', 'is_delivered__25': 1, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'deleted_at__25': None, 'content__25': '나도야~ 🥰', 'image_url__25': None, 'embed_index__25': None, 'couple_id__26': '1', 'has_image__26': 0, 'user_id__26': '1', 'is_delivered__26': 1, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'deleted_at__26': None, 'content__26': '일주일 진짜 빠르다', 'image_url__26': None, 'embed_index__26': None, 'couple_id__27': '1', 'has_image__27': 0, 'user_id__27': '2', 'is_delivered__27': 1, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'deleted_at__27': None, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'image_url__27': None, 'embed_index__27': None, 'couple_id__28': '1', 'has_image__28': 0, 'user_id__28': '1', 'is_delivered__28': 1, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'deleted_at__28': None, 'content__28': '너 있어서 든든했어', 'image_url__28': None, 'embed_index__28': None, 'couple_id__29': '1', 'has_image__29': 0, 'user_id__29': '2', 'is_delivered__29': 1, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'deleted_at__29': None, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'image_url__29': None, 'embed_index__29': None}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:20][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': 'hello', 'created_at': datetime.datetime(2025, 7, 13, 14, 36, 20, 162483), 'embed_index': None}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [generated in 0.00048s] {'pk_1': 1}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [generated in 0.00037s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [generated in 0.00019s] {'user_id_1': '2'}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [generated in 0.00009s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] SELECT users.user_id AS users_user_id, users.name AS users_name, users.email AS users_email, users.created_at AS users_created_at, users.deleted_at AS users_deleted_at, users.modified_at AS users_modified_at, users.birth AS users_birth, users.gender AS users_gender 
FROM users 
WHERE users.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [cached since 0.007795s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] [cached since 0.009184s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:20][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:20][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=3
[2025-07-13 23:36:22][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:36:22][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] [cached since 1.87s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': 'Hello 수아님! How are you today? If you have any relationship questions, feel free to ask. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 36, 22, 26913), 'embed_index': None}
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] [cached since 1.872s ago] {'pk_1': 2}
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] [cached since 1.87s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:22][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] [cached since 1.872s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] [cached since 1.873s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] [cached since 1.873s ago] {'user_id_1': '2'}
[2025-07-13 23:36:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:36:57][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:36:57][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:36:57][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00022s] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00047s] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [no key 0.00012s] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:36:57][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 36, 58, 286553), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 36, 58, 286556), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 36, 58, 294348)}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [generated in 0.00019s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'choice_id__0': 2, 'user_id__0': '1', 'custom_input__0': None, 'question_id__0': 1, 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 36, 57, 783851), 'choice_id__1': 8, 'user_id__1': '1', 'custom_input__1': None, 'question_id__1': 2, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 36, 57, 783866), 'choice_id__2': 13, 'user_id__2': '1', 'custom_input__2': None, 'question_id__2': 3, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 36, 57, 783874), 'choice_id__3': 21, 'user_id__3': '1', 'custom_input__3': None, 'question_id__3': 4, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 36, 57, 783881), 'choice_id__4': 26, 'user_id__4': '1', 'custom_input__4': None, 'question_id__4': 5, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 36, 57, 783888), 'choice_id__5': 1, 'user_id__5': '2', 'custom_input__5': None, 'question_id__5': 1, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 36, 57, 783894), 'choice_id__6': 9, 'user_id__6': '2', 'custom_input__6': None, 'question_id__6': 2, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 36, 57, 783899), 'choice_id__7': 16, 'user_id__7': '2', 'custom_input__7': None, 'question_id__7': 3, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 36, 57, 783906), 'choice_id__8': 20, 'user_id__8': '2', 'custom_input__8': None, 'question_id__8': 4, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 36, 57, 783912), 'choice_id__9': 25, 'user_id__9': '2', 'custom_input__9': None, 'question_id__9': 5, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 36, 57, 783919)}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'emotion__0': '고마움', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'user_id__1': '1', 'emotion__1': '기대감', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__2': '1', 'emotion__2': '미안함', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'user_id__3': '1', 'emotion__3': '죄책감', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'user_id__4': '1', 'emotion__4': '사랑', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__5': '1', 'emotion__5': '다정함', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__6': '1', 'emotion__6': '친밀감', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'memo__6': '너와의 대화가 편하고 좋았어.', 'user_id__7': '1', 'emotion__7': '억울함', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'user_id__8': '1', 'emotion__8': '서운함', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'memo__8': '너의 반응이 조금 서운했어.', 'user_id__9': '1', 'emotion__9': '행복', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'user_id__10': '1', 'emotion__10': '감사', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'memo__10': '네가 있어줘서 고마운 하루였어.', 'user_id__11': '1', 'emotion__11': '신뢰', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'user_id__12': '1', 'emotion__12': '애정' ... 8 parameters truncated ... 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'memo__14': '서로 바빠도 너를 떠올리게 됐어.', 'user_id__15': '2', 'emotion__15': '서운함', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'memo__15': '너의 반응이 조금 서운했어.', 'user_id__16': '2', 'emotion__16': '실망감', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'user_id__17': '2', 'emotion__17': '이해', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'memo__17': '네 입장에서 생각해보게 됐어.', 'user_id__18': '2', 'emotion__18': '다정함', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__19': '2', 'emotion__19': '호감', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'memo__19': '너의 말투나 행동이 참 좋았어.', 'user_id__20': '2', 'emotion__20': '편안함', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'memo__20': '너와 있으면 참 편안해.', 'user_id__21': '2', 'emotion__21': '기대감', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__22': '2', 'emotion__22': '불만', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'user_id__23': '2', 'emotion__23': '기쁨', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'user_id__24': '2', 'emotion__24': '감동', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'memo__24': '사소한 행동에도 감동했어.', 'user_id__25': '2', 'emotion__25': '사랑', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__26': '2', 'emotion__26': '안정감', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.'}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s (insertmanyvalues) 1/1 (ordered)] {'couple_id__0': '1', 'user_id__0': '1', 'embed_index__0': None, 'has_image__0': 0, 'deleted_at__0': None, 'image_url__0': None, 'is_delivered__0': 1, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'couple_id__1': '1', 'user_id__1': '2', 'embed_index__1': None, 'has_image__1': 0, 'deleted_at__1': None, 'image_url__1': None, 'is_delivered__1': 1, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'couple_id__2': '1', 'user_id__2': '1', 'embed_index__2': None, 'has_image__2': 0, 'deleted_at__2': None, 'image_url__2': None, 'is_delivered__2': 1, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'couple_id__3': '1', 'user_id__3': '2', 'embed_index__3': None, 'has_image__3': 0, 'deleted_at__3': None, 'image_url__3': None, 'is_delivered__3': 1, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'couple_id__4': '1', 'user_id__4': '2', 'embed_index__4': None, 'has_image__4': 0, 'deleted_at__4': None, 'image_url__4': None, 'is_delivered__4': 1, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'content__4': '어제 약속했는데 통화 못했네 😕', 'couple_id__5': '1', 'user_id__5': '1', 'embed_index__5': None, 'has_image__5': 0, 'deleted_at__5': None ... 170 parameters truncated ... 'deleted_at__24': None, 'image_url__24': None, 'is_delivered__24': 1, 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'content__24': '너랑 시간 보내는 거 제일 좋아', 'couple_id__25': '1', 'user_id__25': '2', 'embed_index__25': None, 'has_image__25': 0, 'deleted_at__25': None, 'image_url__25': None, 'is_delivered__25': 1, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'content__25': '나도야~ 🥰', 'couple_id__26': '1', 'user_id__26': '1', 'embed_index__26': None, 'has_image__26': 0, 'deleted_at__26': None, 'image_url__26': None, 'is_delivered__26': 1, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'content__26': '일주일 진짜 빠르다', 'couple_id__27': '1', 'user_id__27': '2', 'embed_index__27': None, 'has_image__27': 0, 'deleted_at__27': None, 'image_url__27': None, 'is_delivered__27': 1, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'couple_id__28': '1', 'user_id__28': '1', 'embed_index__28': None, 'has_image__28': 0, 'deleted_at__28': None, 'image_url__28': None, 'is_delivered__28': 1, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'content__28': '너 있어서 든든했어', 'couple_id__29': '1', 'user_id__29': '2', 'embed_index__29': None, 'has_image__29': 0, 'deleted_at__29': None, 'image_url__29': None, 'is_delivered__29': 1, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'content__29': '다음 주도 잘 지내보자! 사랑해 😘'}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:36:58][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:42][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:38:42][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:38:42][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00013s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00024s] {}
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:38:42][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [no key 0.00023s] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 38, 43, 115756), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 38, 43, 115759), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 38, 43, 121439)}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [generated in 0.00019s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'choice_id__0': 2, 'user_id__0': '1', 'custom_input__0': None, 'question_id__0': 1, 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 38, 42, 612630), 'choice_id__1': 8, 'user_id__1': '1', 'custom_input__1': None, 'question_id__1': 2, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 38, 42, 612646), 'choice_id__2': 13, 'user_id__2': '1', 'custom_input__2': None, 'question_id__2': 3, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 38, 42, 612653), 'choice_id__3': 21, 'user_id__3': '1', 'custom_input__3': None, 'question_id__3': 4, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 38, 42, 612660), 'choice_id__4': 26, 'user_id__4': '1', 'custom_input__4': None, 'question_id__4': 5, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 38, 42, 612667), 'choice_id__5': 1, 'user_id__5': '2', 'custom_input__5': None, 'question_id__5': 1, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 38, 42, 612672), 'choice_id__6': 9, 'user_id__6': '2', 'custom_input__6': None, 'question_id__6': 2, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 38, 42, 612678), 'choice_id__7': 16, 'user_id__7': '2', 'custom_input__7': None, 'question_id__7': 3, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 38, 42, 612684), 'choice_id__8': 20, 'user_id__8': '2', 'custom_input__8': None, 'question_id__8': 4, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 38, 42, 612690), 'choice_id__9': 25, 'user_id__9': '2', 'custom_input__9': None, 'question_id__9': 5, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 38, 42, 612696)}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'emotion__0': '고마움', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__1': '1', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'emotion__1': '기대감', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__2': '1', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'emotion__2': '미안함', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__3': '1', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'emotion__3': '죄책감', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__4': '1', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'emotion__4': '사랑', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__5': '1', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'emotion__5': '다정함', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__6': '1', 'memo__6': '너와의 대화가 편하고 좋았어.', 'emotion__6': '친밀감', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__7': '1', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'emotion__7': '억울함', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__8': '1', 'memo__8': '너의 반응이 조금 서운했어.', 'emotion__8': '서운함', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__9': '1', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'emotion__9': '행복', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__10': '1', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'emotion__10': '감사', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__11': '1', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'emotion__11': '신뢰', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__12': '1', 'memo__12': '너에 대한 애정이 넘쳤어.' ... 8 parameters truncated ... 'emotion__14': '바쁨', 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__15': '2', 'memo__15': '너의 반응이 조금 서운했어.', 'emotion__15': '서운함', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__16': '2', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'emotion__16': '실망감', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__17': '2', 'memo__17': '네 입장에서 생각해보게 됐어.', 'emotion__17': '이해', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__18': '2', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'emotion__18': '다정함', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__19': '2', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'emotion__19': '호감', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__20': '2', 'memo__20': '너와 있으면 참 편안해.', 'emotion__20': '편안함', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__21': '2', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'emotion__21': '기대감', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__22': '2', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'emotion__22': '불만', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__23': '2', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'emotion__23': '기쁨', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__24': '2', 'memo__24': '사소한 행동에도 감동했어.', 'emotion__24': '감동', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__25': '2', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'emotion__25': '사랑', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__26': '2', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'emotion__26': '안정감', 'date__26': datetime.datetime(2025, 7, 7, 0, 0)}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s (insertmanyvalues) 1/1 (ordered)] {'embed_index__0': None, 'has_image__0': 0, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'user_id__0': '1', 'is_delivered__0': 1, 'couple_id__0': '1', 'image_url__0': None, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'deleted_at__0': None, 'embed_index__1': None, 'has_image__1': 0, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'user_id__1': '2', 'is_delivered__1': 1, 'couple_id__1': '1', 'image_url__1': None, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'deleted_at__1': None, 'embed_index__2': None, 'has_image__2': 0, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'user_id__2': '1', 'is_delivered__2': 1, 'couple_id__2': '1', 'image_url__2': None, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'deleted_at__2': None, 'embed_index__3': None, 'has_image__3': 0, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'user_id__3': '2', 'is_delivered__3': 1, 'couple_id__3': '1', 'image_url__3': None, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'deleted_at__3': None, 'embed_index__4': None, 'has_image__4': 0, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'user_id__4': '2', 'is_delivered__4': 1, 'couple_id__4': '1', 'image_url__4': None, 'content__4': '어제 약속했는데 통화 못했네 😕', 'deleted_at__4': None, 'embed_index__5': None, 'has_image__5': 0, 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40), 'user_id__5': '1', 'is_delivered__5': 1 ... 170 parameters truncated ... 'is_delivered__24': 1, 'couple_id__24': '1', 'image_url__24': None, 'content__24': '너랑 시간 보내는 거 제일 좋아', 'deleted_at__24': None, 'embed_index__25': None, 'has_image__25': 0, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'user_id__25': '2', 'is_delivered__25': 1, 'couple_id__25': '1', 'image_url__25': None, 'content__25': '나도야~ 🥰', 'deleted_at__25': None, 'embed_index__26': None, 'has_image__26': 0, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'user_id__26': '1', 'is_delivered__26': 1, 'couple_id__26': '1', 'image_url__26': None, 'content__26': '일주일 진짜 빠르다', 'deleted_at__26': None, 'embed_index__27': None, 'has_image__27': 0, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'user_id__27': '2', 'is_delivered__27': 1, 'couple_id__27': '1', 'image_url__27': None, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'deleted_at__27': None, 'embed_index__28': None, 'has_image__28': 0, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'user_id__28': '1', 'is_delivered__28': 1, 'couple_id__28': '1', 'image_url__28': None, 'content__28': '너 있어서 든든했어', 'deleted_at__28': None, 'embed_index__29': None, 'has_image__29': 0, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'user_id__29': '2', 'is_delivered__29': 1, 'couple_id__29': '1', 'image_url__29': None, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'deleted_at__29': None}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:38:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:03][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '나 남친이랑 싸웟어..', 'created_at': datetime.datetime(2025, 7, 13, 14, 39, 3, 234670), 'embed_index': None}
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'pk_1': 1}
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] [cached since 0.001866s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:39:03][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:03][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=5
[2025-07-13 23:39:05][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:39:05][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] [cached since 2.685s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '어머, 그런 일이 있었군요. 많이 속상하셨겠어요. 혹시 어떤 일로 싸우게 되었는지 조금 이야기해 주실 수 있나요? 도움이 될 수 있도록 잘 들어드릴게요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 39, 5, 920259), 'embed_index': None}
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] [cached since 2.689s ago] {'pk_1': 2}
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] [cached since 2.689s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:05][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=2
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] [cached since 2.691s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] [cached since 2.692s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id_1': '2'}
[2025-07-13 23:39:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [cached since 25.8s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:29][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [cached since 25.8s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '나 여친이랑 싸웟어.', 'created_at': datetime.datetime(2025, 7, 13, 14, 39, 29, 34485), 'embed_index': None}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [cached since 25.8s ago] {'pk_1': 3}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [cached since 25.8s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [cached since 23.1s ago] {'user_id_1': '1'}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] SELECT users.user_id AS users_user_id, users.name AS users_name, users.email AS users_email, users.created_at AS users_created_at, users.deleted_at AS users_deleted_at, users.modified_at AS users_modified_at, users.birth AS users_birth, users.gender AS users_gender 
FROM users 
WHERE users.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [cached since 25.8s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] [cached since 25.8s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:29][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:29][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=3
[2025-07-13 23:39:31][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:39:31][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] [cached since 27.82s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '어떤 일로 싸우게 됐는지 마음이 무겁네요. 혹시 상황을 좀 더 이야기해 줄 수 있을까요? 그때 어떤 기분이었는지도 같이 들려주면 좋을 것 같아요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 39, 31, 58722), 'embed_index': None}
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] [cached since 27.83s ago] {'pk_1': 4}
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] [cached since 27.83s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:31][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=4
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] [cached since 27.83s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] [cached since 27.83s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] [cached since 25.14s ago] {'user_id_1': '1'}
[2025-07-13 23:39:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] [cached since 42.68s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:45][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] [cached since 42.68s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '내이름 뭔지알아?', 'created_at': datetime.datetime(2025, 7, 13, 14, 39, 45, 929621), 'embed_index': None}
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] [cached since 42.68s ago] {'pk_1': 5}
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] [cached since 42.68s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] [cached since 42.69s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:45][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=5
[2025-07-13 23:39:47][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:39:47][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] [cached since 43.78s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '물론이죠, 지민님! 어떤 이야기를 나누고 싶으세요? 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 39, 47, 12108), 'embed_index': None}
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] [cached since 43.78s ago] {'pk_1': 6}
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] [cached since 43.78s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:47][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=6
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] [cached since 43.78s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] [cached since 43.78s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] [cached since 41.09s ago] {'user_id_1': '1'}
[2025-07-13 23:39:47][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] [cached since 76.63s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:19][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] [cached since 76.63s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '넌 이름이 뭐야?', 'created_at': datetime.datetime(2025, 7, 13, 14, 40, 19, 869916), 'embed_index': None}
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] [cached since 76.63s ago] {'pk_1': 7}
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] [cached since 76.63s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] [cached since 76.63s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:40:19][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:19][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=7
[2025-07-13 23:40:21][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:40:21][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] [cached since 78.08s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '저는 무민이라고 해요. 지민님께 도움을 드리고 싶어요. 혹시 더 이야기하고 싶은 게 있으면 언제든지 말씀해 주세요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 40, 21, 318677), 'embed_index': None}
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] [cached since 78.09s ago] {'pk_1': 8}
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] [cached since 78.09s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:21][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=8
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] [cached since 78.09s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] [cached since 78.09s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] [cached since 75.4s ago] {'user_id_1': '1'}
[2025-07-13 23:40:21][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:27][INFO][routers.ai_chat] [set_ai_bot_config] user_id=1, persona_name=지수
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] [cached since 58.19s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] INSERT INTO persona_config (couple_id, persona_name, updated_at) VALUES (%(couple_id)s, %(persona_name)s, %(updated_at)s)
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'couple_id': '1', 'persona_name': '지수', 'updated_at': datetime.datetime(2025, 7, 13, 14, 40, 27, 238493)}
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.user_1 IS NULL OR couples.user_2 IS NULL 
 LIMIT %(param_1)s
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] [generated in 0.00008s] {'param_1': 1}
[2025-07-13 23:40:27][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:40:30][INFO][routers.ai_chat] [set_ai_bot_config] user_id=1, persona_name=지수
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] [cached since 61.18s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] UPDATE persona_config SET updated_at=%(updated_at)s WHERE persona_config.couple_id = %(persona_config_couple_id)s
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'updated_at': datetime.datetime(2025, 7, 13, 14, 40, 30, 234508), 'persona_config_couple_id': '1'}
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.user_1 IS NULL OR couples.user_2 IS NULL 
 LIMIT %(param_1)s
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] [cached since 2.998s ago] {'param_1': 1}
[2025-07-13 23:40:30][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:42:07][INFO][routers.ai_chat] [set_ai_bot_config] user_id=1, persona_name=지수
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] [cached since 158.1s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] UPDATE persona_config SET updated_at=%(updated_at)s WHERE persona_config.couple_id = %(persona_config_couple_id)s
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] [cached since 96.87s ago] {'updated_at': datetime.datetime(2025, 7, 13, 14, 42, 7, 103322), 'persona_config_couple_id': '1'}
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.user_1 IS NULL OR couples.user_2 IS NULL 
 LIMIT %(param_1)s
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] [cached since 99.86s ago] {'param_1': 1}
[2025-07-13 23:42:07][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:37][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:37][INFO][sqlalchemy.engine.Engine] SELECT messages.chat_id AS messages_chat_id, messages.user_id AS messages_user_id, messages.couple_id AS messages_couple_id, messages.content AS messages_content, messages.image_url AS messages_image_url, messages.has_image AS messages_has_image, messages.created_at AS messages_created_at, messages.deleted_at AS messages_deleted_at, messages.is_delivered AS messages_is_delivered, messages.embed_index AS messages_embed_index 
FROM messages 
WHERE messages.couple_id = %(couple_id_1)s AND messages.user_id = %(user_id_1)s AND messages.is_delivered = false ORDER BY messages.created_at
[2025-07-13 23:43:37][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'couple_id_1': '1', 'user_id_1': '테스트파트너'}
[2025-07-13 23:43:37][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:41][INFO][routers.ai_chat] [set_ai_bot_config] user_id=1, persona_name=지수
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] [cached since 252.7s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] UPDATE persona_config SET updated_at=%(updated_at)s WHERE persona_config.couple_id = %(persona_config_couple_id)s
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] [cached since 191.5s ago] {'updated_at': datetime.datetime(2025, 7, 13, 14, 43, 41, 733901), 'persona_config_couple_id': '1'}
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] SELECT persona_config.couple_id AS persona_config_couple_id, persona_config.persona_name AS persona_config_persona_name, persona_config.updated_at AS persona_config_updated_at 
FROM persona_config 
WHERE persona_config.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] [cached since 252.7s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] UPDATE persona_config SET updated_at=%(updated_at)s WHERE persona_config.couple_id = %(persona_config_couple_id)s
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] [cached since 191.5s ago] {'updated_at': datetime.datetime(2025, 7, 13, 14, 43, 41, 738831), 'persona_config_couple_id': '1'}
[2025-07-13 23:43:41][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:41][INFO][routers.ai_chat] [set_ai_bot_config] 챗봇 이름 저장 완료: user_id=1, partner_id=2, persona_name=지수
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] [cached since 288s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:51][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] [cached since 288s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '넌 이름이 뭐야?', 'created_at': datetime.datetime(2025, 7, 13, 14, 43, 51, 233361), 'embed_index': None}
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] [cached since 288s ago] {'pk_1': 9}
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] [cached since 288s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] [cached since 288s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:51][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:51][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=9
[2025-07-13 23:43:53][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:43:53][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 290.3s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '저는 지수라고 해요. 지민님의 이야기를 듣고 도와드리는 게 제 역할이에요. 혹시 함께 나누고 싶은 이야기가 있으면 언제든지 말해주세요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 43, 53, 514219), 'embed_index': None}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 290.3s ago] {'pk_1': 10}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 290.3s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:53][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=10
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 290.3s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 290.3s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 287.6s ago] {'user_id_1': '1'}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:43:53][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {'id_1': 3, 'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'embed_index': 0, 'ai_messages_id': 3}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 0.008791s ago] {'id_1': 4, 'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 0.008429s ago] {'embed_index': 0, 'ai_messages_id': 4}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 0.01277s ago] {'id_1': 5, 'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:43:53][INFO][sqlalchemy.engine.Engine] [cached since 0.01229s ago] {'embed_index': 0, 'ai_messages_id': 5}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.01681s ago] {'id_1': 6, 'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.01631s ago] {'embed_index': 0, 'ai_messages_id': 6}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.02056s ago] {'id_1': 7, 'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.02013s ago] {'embed_index': 0, 'ai_messages_id': 7}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.02521s ago] {'id_1': 8, 'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.02488s ago] {'embed_index': 0, 'ai_messages_id': 8}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.03599s ago] {'id_1': 9, 'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.03564s ago] {'embed_index': 0, 'ai_messages_id': 9}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.04096s ago] {'id_1': 10, 'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] [cached since 0.04057s ago] {'embed_index': 0, 'ai_messages_id': 10}
[2025-07-13 23:43:54][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] [cached since 313.5s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:44:16][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] [cached since 313.5s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '혹시 너 이름이 뭐야?', 'created_at': datetime.datetime(2025, 7, 13, 14, 44, 16, 773863), 'embed_index': None}
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] [cached since 313.5s ago] {'pk_1': 11}
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] [cached since 313.5s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] [cached since 313.5s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:44:16][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:44:16][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=7
[2025-07-13 23:44:18][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:44:18][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] [cached since 315.2s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '저는 지수라고 해요. 수아님께 도움이 될 수 있으면 좋겠어요. 마음이 복잡할 때, 어떤 이야기든 편하게 나눠주세요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 44, 18, 438477), 'embed_index': None}
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] [cached since 315.2s ago] {'pk_1': 12}
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] [cached since 315.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:44:18][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=12
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] [cached since 315.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] [cached since 315.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] [cached since 312.5s ago] {'user_id_1': '2'}
[2025-07-13 23:44:18][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:09][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:09][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:45:09][INFO][sqlalchemy.engine.Engine] [cached since 366.8s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:45:09][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:10][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] [cached since 366.8s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '내가 남자친구랑 게임하는데 자꾸 나한테 뭐라고 하는거야', 'created_at': datetime.datetime(2025, 7, 13, 14, 45, 10, 238), 'embed_index': None}
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] [cached since 366.8s ago] {'pk_1': 13}
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] [cached since 366.8s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] [cached since 366.8s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:10][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:10][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=9
[2025-07-13 23:45:11][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:45:11][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] [cached since 368.5s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '게임을 하면서 남자친구가 계속 뭐라고 하니까 속상하셨겠어요. 혹시 그 상황에서 구체적으로 어떤 말을 들으셨는지, 그리고 수아님이 어떻게 느끼셨는지 조금 더 이야기해 주실 수 있을까요? 서로의 생각을 이해하는 데 도움이 될 거예요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 45, 11, 766718), 'embed_index': None}
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] [cached since 368.5s ago] {'pk_1': 14}
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] [cached since 368.5s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:11][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=14
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] [cached since 368.5s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] [cached since 368.5s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] [cached since 365.8s ago] {'user_id_1': '2'}
[2025-07-13 23:45:11][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] [cached since 388.4s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:31][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] [cached since 388.4s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '아니 남친은 게임을 좀 하고 난 못하는데 그거 가지고 계속 뭐라고해 당연히 못할 수있잖아', 'created_at': datetime.datetime(2025, 7, 13, 14, 45, 31, 690553), 'embed_index': None}
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] [cached since 388.4s ago] {'pk_1': 15}
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] [cached since 388.4s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] [cached since 388.4s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:31][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:31][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=11
[2025-07-13 23:45:36][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:45:36][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] [cached since 393.5s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '맞아요, 처음 시작할 때는 누구나 부족할 수 있는 거죠. 남친의 그런 태도가 수아님을 서운하게 만들었을 것 같아요. 본인도 조금씩 배우며 나아질 수 있다는 걸 남자친구가 이해해줬으면 좋겠네요. 혹시 이런 부분에 대해 남친과 이야기해보신 적이 있을까요? 서로의 감정이나 생각을 솔직하게 나눠보는 것도 좋을 것 같아요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 45, 36, 763172), 'embed_index': None}
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] [cached since 393.5s ago] {'pk_1': 16}
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] [cached since 393.5s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:36][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=16
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] [cached since 393.5s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] [cached since 393.5s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] [cached since 390.8s ago] {'user_id_1': '2'}
[2025-07-13 23:45:36][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:47:07][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.1s ago] {'id_1': 1, 'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.1s ago] {'embed_index': 0, 'ai_messages_id': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.1s ago] {'id_1': 2, 'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.1s ago] {'embed_index': 0, 'ai_messages_id': 2}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'id_1': 11, 'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'embed_index': 0, 'ai_messages_id': 11}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'id_1': 12, 'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'embed_index': 0, 'ai_messages_id': 12}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'id_1': 13, 'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'embed_index': 0, 'ai_messages_id': 13}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'id_1': 14, 'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'embed_index': 0, 'ai_messages_id': 14}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'id_1': 15, 'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'embed_index': 0, 'ai_messages_id': 15}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(id_1)s AND ai_messages.user_id = %(user_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'id_1': 16, 'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] UPDATE ai_messages SET embed_index=%(embed_index)s WHERE ai_messages.id = %(ai_messages_id)s
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] [cached since 103.2s ago] {'embed_index': 0, 'ai_messages_id': 16}
[2025-07-13 23:47:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] [cached since 415.9s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:59][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] [cached since 415.9s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '내가 말은 했는데 이럴거면 그냥 같이 게임하지 말재 난 같이하고싶은데', 'created_at': datetime.datetime(2025, 7, 13, 14, 45, 59, 122622), 'embed_index': None}
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] [cached since 415.9s ago] {'pk_1': 17}
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] [cached since 415.9s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] [cached since 415.9s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:45:59][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:45:59][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=13
[2025-07-13 23:46:00][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:46:00][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] [cached since 417.7s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '수아님 입장에서는 같이 게임을 즐기고 싶어서 더 속상하셨겠어요. 남자친구에게 정말 함께 하고 싶다는 마음을 진솔하게 전할 기회가 있다면 좋을 것 같네요. 아마 시간이 지나면서 서로 이해하고 즐길 수 있는 방법을 찾을 수 있을 거예요. 혹시 남친이 좋아하는 다른 활동이 있다면 그걸 함께 해보는 것도 또 다른 방법일 수도 있겠네요. ', 'created_at': datetime.datetime(2025, 7, 13, 14, 46, 0, 991658), 'embed_index': None}
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] [cached since 417.7s ago] {'pk_1': 18}
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] [cached since 417.7s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:46:00][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=18
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] [cached since 417.7s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:46:00][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:46:01][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:01][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:46:01][INFO][sqlalchemy.engine.Engine] [cached since 417.8s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:46:01][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:46:01][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:01][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:46:01][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id_1': '2', 'role_1': 'function'}
[2025-07-13 23:46:01][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] [cached since 454.2s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:07][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] [cached since 454.2s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '무튼 그래서 게임하는데 나보고 트롤이라고 뭐라고하고 진짜 속상해서 울었어', 'created_at': datetime.datetime(2025, 7, 13, 14, 48, 7, 756335), 'embed_index': None}
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] [cached since 454.2s ago] {'pk_1': 19}
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] [cached since 454.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] [cached since 454.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:07][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:07][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=15
[2025-07-13 23:46:39][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:46:39][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] [cached since 456.7s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': "정말 마음 아프셨겠어요, 수아님. '트롤'이라는 표현은 확실히 상처가 될 수 있죠. 나중에라도 그 상황에서 어떻게 느꼈는지 진심으로 이야기해보는 건 어떨까요? 남자친구도 그 당시에는 감정적으로 반응했을 수도 있지만, 상황을 이해하면 더 나은 방향으로 서로를 이해할 수 있을 거라고 생각해요. 마음이 조금이라도 편안해지셨으면 좋겠네요. 💕", 'created_at': datetime.datetime(2025, 7, 13, 14, 46, 39, 914544), 'embed_index': None}
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] [cached since 456.7s ago] {'pk_1': 20}
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] [cached since 456.7s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:46:39][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=20
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] [cached since 456.7s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] [cached since 456.7s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] [cached since 38.93s ago] {'user_id_1': '2', 'role_1': 'function'}
[2025-07-13 23:46:39][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] [cached since 489.2s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:42][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] [cached since 489.2s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '남친한테 뭐라고 말하는게 좋을까? 나도 못하는건 아는데 같이 그냥 즐겼으면 좋겠어', 'created_at': datetime.datetime(2025, 7, 13, 14, 48, 42, 774501), 'embed_index': None}
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] [cached since 489.2s ago] {'pk_1': 21}
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] [cached since 489.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] [cached since 489.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:42][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:42][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=17
[2025-07-13 23:47:14][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:47:14][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] [cached since 491.2s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '수아님이 무엇을 원하는지 상대방에게 솔직하게 전하는 것이 중요할 것 같아요. 예를 들어, “나도 아직 게임을 배우는 중이니까, 같이 즐기면서 조금씩 나아가고 싶어. 네가 그런 부분을 이해해주고 같이 웃으면서 게임 할 수 있었으면 정말 좋겠어.” 같은 식으로요. 수아님의 진심이 잘 전달되길 바랄게요. 🤗', 'created_at': datetime.datetime(2025, 7, 13, 14, 47, 14, 454756), 'embed_index': None}
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] [cached since 491.2s ago] {'pk_1': 22}
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] [cached since 491.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:47:14][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=22
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] [cached since 491.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] [cached since 491.2s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] [cached since 73.45s ago] {'user_id_1': '2', 'role_1': 'function'}
[2025-07-13 23:47:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] [cached since 576.9s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:40][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=2, couple_id=1
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] [cached since 576.9s ago] {'user_id': '2', 'couple_id': '1', 'role': 'user', 'content': '고마워 근데 남친도 나한테 뭐라고 하고싶어서 하는 느낌이아니라 계속 지니까 답답한가봐', 'created_at': datetime.datetime(2025, 7, 13, 14, 48, 40, 113509), 'embed_index': None}
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] [cached since 576.9s ago] {'pk_1': 23}
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] [cached since 576.9s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] [cached since 576.9s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:40][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:40][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=2, history_len=19
[2025-07-13 23:48:54][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:48:54][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=2
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] [cached since 591s ago] {'user_id': '2', 'couple_id': '1', 'role': 'assistant', 'content': '그런 마음도 이해가 되네요. 게임에서 이기는 것이 중요할 때도 있지만, 함께 즐기는 과정도 큰 의미가 있잖아요. 남자친구도 어쩌면 이기고 싶은 마음에 잠시 감정을 앞세웠을지도 몰라요. 그런 점을 남자친구에게 얘기한다면, 너그럽게 이해하려는 마음을 가질 수도 있을 것 같아요. 수아님이 이해하려는 마음이 느껴져서 정말 좋은 것 같아요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 48, 54, 195725), 'embed_index': None}
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] [cached since 591s ago] {'pk_1': 24}
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] [cached since 591s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:54][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=2, msg_id=24
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] [cached since 591s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] [cached since 591s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] [cached since 173.2s ago] {'user_id_1': '2', 'role_1': 'function'}
[2025-07-13 23:48:54][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:48:56][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:48:56][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:56][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_chat_summaries (user_id, couple_id, summary, emb_id, created_at, last_msg_id) VALUES (%(user_id)s, %(couple_id)s, %(summary)s, %(emb_id)s, %(created_at)s, %(last_msg_id)s)
[2025-07-13 23:48:56][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'user_id': '2', 'couple_id': '1', 'summary': '지수라는 가상의 조언자는 수아님과의 대화에서 관계 문제를 다루고 있습니다. 최근에 수아님은 남자친구와 게임을 하다가 다툼이 있었다고 밝혔습니다. 수아님은 남자친구가 게임 중에 자꾸 자신에게 뭐라고 해서 속상했다고 이야기했습니다. 지수는 그 상황에 대해 더 자세히 들어보고자 하며, 수아님의 감정을 이해하고 돕기 위해 노력하고 있습니다.', 'emb_id': None, 'created_at': datetime.datetime(2025, 7, 13, 14, 48, 56, 390049), 'last_msg_id': 14}
[2025-07-13 23:48:56][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:48:56][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:48:56][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:48:56][INFO][sqlalchemy.engine.Engine] [cached since 593.1s ago] {'user_id_1': '2', 'param_1': 1}
[2025-07-13 23:48:56][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:53:24][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:53:24][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:53:24][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00011s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00021s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:53:24][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 53, 25, 115732), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 53, 25, 115735), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 53, 25, 123303)}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [generated in 0.00023s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'question_id__0': 1, 'choice_id__0': 2, 'custom_input__0': None, 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 53, 24, 606773), 'user_id__0': '1', 'question_id__1': 2, 'choice_id__1': 8, 'custom_input__1': None, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 53, 24, 606790), 'user_id__1': '1', 'question_id__2': 3, 'choice_id__2': 13, 'custom_input__2': None, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 53, 24, 606798), 'user_id__2': '1', 'question_id__3': 4, 'choice_id__3': 21, 'custom_input__3': None, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 53, 24, 606804), 'user_id__3': '1', 'question_id__4': 5, 'choice_id__4': 26, 'custom_input__4': None, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 53, 24, 606811), 'user_id__4': '1', 'question_id__5': 1, 'choice_id__5': 1, 'custom_input__5': None, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 53, 24, 606817), 'user_id__5': '2', 'question_id__6': 2, 'choice_id__6': 9, 'custom_input__6': None, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 53, 24, 606822), 'user_id__6': '2', 'question_id__7': 3, 'choice_id__7': 16, 'custom_input__7': None, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 53, 24, 606828), 'user_id__7': '2', 'question_id__8': 4, 'choice_id__8': 20, 'custom_input__8': None, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 53, 24, 606834), 'user_id__8': '2', 'question_id__9': 5, 'choice_id__9': 25, 'custom_input__9': None, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 53, 24, 606840), 'user_id__9': '2'}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'emotion__0': '고마움', 'user_id__0': '1', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'user_id__1': '1', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__2': '미안함', 'user_id__2': '1', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'user_id__3': '1', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__4': '사랑', 'user_id__4': '1', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'user_id__5': '1', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__6': '친밀감', 'user_id__6': '1', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__7': '억울함', 'user_id__7': '1', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'user_id__8': '1', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__9': '행복', 'user_id__9': '1', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'user_id__10': '1', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__11': '신뢰', 'user_id__11': '1', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__12': '애정', 'user_id__12': '1' ... 8 parameters truncated ... 'memo__14': '서로 바빠도 너를 떠올리게 됐어.', 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__15': '서운함', 'user_id__15': '2', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'user_id__16': '2', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__17': '이해', 'user_id__17': '2', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'user_id__18': '2', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__19': '호감', 'user_id__19': '2', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'user_id__20': '2', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__21': '기대감', 'user_id__21': '2', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'user_id__22': '2', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__23': '기쁨', 'user_id__23': '2', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'user_id__24': '2', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__25': '사랑', 'user_id__25': '2', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감', 'user_id__26': '2', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0)}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s (insertmanyvalues) 1/1 (ordered)] {'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'deleted_at__0': None, 'couple_id__0': '1', 'image_url__0': None, 'embed_index__0': None, 'has_image__0': 0, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'is_delivered__0': 1, 'user_id__0': '1', 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'deleted_at__1': None, 'couple_id__1': '1', 'image_url__1': None, 'embed_index__1': None, 'has_image__1': 0, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'is_delivered__1': 1, 'user_id__1': '2', 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'deleted_at__2': None, 'couple_id__2': '1', 'image_url__2': None, 'embed_index__2': None, 'has_image__2': 0, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'is_delivered__2': 1, 'user_id__2': '1', 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'deleted_at__3': None, 'couple_id__3': '1', 'image_url__3': None, 'embed_index__3': None, 'has_image__3': 0, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'is_delivered__3': 1, 'user_id__3': '2', 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'deleted_at__4': None, 'couple_id__4': '1', 'image_url__4': None, 'embed_index__4': None, 'has_image__4': 0, 'content__4': '어제 약속했는데 통화 못했네 😕', 'is_delivered__4': 1, 'user_id__4': '2', 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40), 'deleted_at__5': None, 'couple_id__5': '1', 'image_url__5': None, 'embed_index__5': None ... 170 parameters truncated ... 'embed_index__24': None, 'has_image__24': 0, 'content__24': '너랑 시간 보내는 거 제일 좋아', 'is_delivered__24': 1, 'user_id__24': '1', 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'deleted_at__25': None, 'couple_id__25': '1', 'image_url__25': None, 'embed_index__25': None, 'has_image__25': 0, 'content__25': '나도야~ 🥰', 'is_delivered__25': 1, 'user_id__25': '2', 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'deleted_at__26': None, 'couple_id__26': '1', 'image_url__26': None, 'embed_index__26': None, 'has_image__26': 0, 'content__26': '일주일 진짜 빠르다', 'is_delivered__26': 1, 'user_id__26': '1', 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'deleted_at__27': None, 'couple_id__27': '1', 'image_url__27': None, 'embed_index__27': None, 'has_image__27': 0, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'is_delivered__27': 1, 'user_id__27': '2', 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'deleted_at__28': None, 'couple_id__28': '1', 'image_url__28': None, 'embed_index__28': None, 'has_image__28': 0, 'content__28': '너 있어서 든든했어', 'is_delivered__28': 1, 'user_id__28': '1', 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'deleted_at__29': None, 'couple_id__29': '1', 'image_url__29': None, 'embed_index__29': None, 'has_image__29': 0, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'is_delivered__29': 1, 'user_id__29': '2'}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:53:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:54][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:54:54][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:54:54][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] [generated in 0.00024s] {}
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:54:54][INFO][sqlalchemy.engine.Engine] [generated in 0.00021s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00011s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00026s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00037s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 54, 55, 421004), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 54, 55, 421007), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 54, 55, 426429)}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00020s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 54, 54, 908526), 'choice_id__0': 2, 'custom_input__0': None, 'question_id__0': 1, 'user_id__1': '1', 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 54, 54, 908555), 'choice_id__1': 8, 'custom_input__1': None, 'question_id__1': 2, 'user_id__2': '1', 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 54, 54, 908569), 'choice_id__2': 13, 'custom_input__2': None, 'question_id__2': 3, 'user_id__3': '1', 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 54, 54, 908581), 'choice_id__3': 21, 'custom_input__3': None, 'question_id__3': 4, 'user_id__4': '1', 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 54, 54, 908592), 'choice_id__4': 26, 'custom_input__4': None, 'question_id__4': 5, 'user_id__5': '2', 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 54, 54, 908603), 'choice_id__5': 1, 'custom_input__5': None, 'question_id__5': 1, 'user_id__6': '2', 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 54, 54, 908613), 'choice_id__6': 9, 'custom_input__6': None, 'question_id__6': 2, 'user_id__7': '2', 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 54, 54, 908620), 'choice_id__7': 16, 'custom_input__7': None, 'question_id__7': 3, 'user_id__8': '2', 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 54, 54, 908626), 'choice_id__8': 20, 'custom_input__8': None, 'question_id__8': 4, 'user_id__9': '2', 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 54, 54, 908637), 'choice_id__9': 25, 'custom_input__9': None, 'question_id__9': 5}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'emotion__0': '고마움', 'user_id__0': '1', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'user_id__1': '1', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__2': '미안함', 'user_id__2': '1', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'user_id__3': '1', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__4': '사랑', 'user_id__4': '1', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'user_id__5': '1', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__6': '친밀감', 'user_id__6': '1', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__7': '억울함', 'user_id__7': '1', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'user_id__8': '1', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__9': '행복', 'user_id__9': '1', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'user_id__10': '1', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__11': '신뢰', 'user_id__11': '1', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__12': '애정', 'user_id__12': '1' ... 8 parameters truncated ... 'memo__14': '서로 바빠도 너를 떠올리게 됐어.', 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__15': '서운함', 'user_id__15': '2', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'user_id__16': '2', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__17': '이해', 'user_id__17': '2', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'user_id__18': '2', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__19': '호감', 'user_id__19': '2', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'user_id__20': '2', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__21': '기대감', 'user_id__21': '2', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'user_id__22': '2', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__23': '기쁨', 'user_id__23': '2', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'user_id__24': '2', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__25': '사랑', 'user_id__25': '2', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감', 'user_id__26': '2', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0)}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'embed_index__0': None, 'user_id__0': '1', 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'is_delivered__0': 1, 'has_image__0': 0, 'couple_id__0': '1', 'deleted_at__0': None, 'image_url__0': None, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'embed_index__1': None, 'user_id__1': '2', 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'is_delivered__1': 1, 'has_image__1': 0, 'couple_id__1': '1', 'deleted_at__1': None, 'image_url__1': None, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'embed_index__2': None, 'user_id__2': '1', 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'is_delivered__2': 1, 'has_image__2': 0, 'couple_id__2': '1', 'deleted_at__2': None, 'image_url__2': None, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'embed_index__3': None, 'user_id__3': '2', 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'is_delivered__3': 1, 'has_image__3': 0, 'couple_id__3': '1', 'deleted_at__3': None, 'image_url__3': None, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'embed_index__4': None, 'user_id__4': '2', 'content__4': '어제 약속했는데 통화 못했네 😕', 'is_delivered__4': 1, 'has_image__4': 0, 'couple_id__4': '1', 'deleted_at__4': None, 'image_url__4': None, 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40), 'embed_index__5': None, 'user_id__5': '1', 'content__5': '미안… 회의 끝나고 뻗어버렸어 ㅠ', 'is_delivered__5': 1 ... 170 parameters truncated ... 'is_delivered__24': 1, 'has_image__24': 0, 'couple_id__24': '1', 'deleted_at__24': None, 'image_url__24': None, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'embed_index__25': None, 'user_id__25': '2', 'content__25': '나도야~ 🥰', 'is_delivered__25': 1, 'has_image__25': 0, 'couple_id__25': '1', 'deleted_at__25': None, 'image_url__25': None, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'embed_index__26': None, 'user_id__26': '1', 'content__26': '일주일 진짜 빠르다', 'is_delivered__26': 1, 'has_image__26': 0, 'couple_id__26': '1', 'deleted_at__26': None, 'image_url__26': None, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'embed_index__27': None, 'user_id__27': '2', 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'is_delivered__27': 1, 'has_image__27': 0, 'couple_id__27': '1', 'deleted_at__27': None, 'image_url__27': None, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'embed_index__28': None, 'user_id__28': '1', 'content__28': '너 있어서 든든했어', 'is_delivered__28': 1, 'has_image__28': 0, 'couple_id__28': '1', 'deleted_at__28': None, 'image_url__28': None, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'embed_index__29': None, 'user_id__29': '2', 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'is_delivered__29': 1, 'has_image__29': 0, 'couple_id__29': '1', 'deleted_at__29': None, 'image_url__29': None}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:54:55][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:14][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:55:14][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:55:14][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00022s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00010s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:14][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 55, 15, 60478), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 55, 15, 60481), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 55, 15, 66515)}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [generated in 0.00021s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'question_id__0': 1, 'custom_input__0': None, 'user_id__0': '1', 'choice_id__0': 2, 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 55, 14, 546425), 'question_id__1': 2, 'custom_input__1': None, 'user_id__1': '1', 'choice_id__1': 8, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 55, 14, 546441), 'question_id__2': 3, 'custom_input__2': None, 'user_id__2': '1', 'choice_id__2': 13, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 55, 14, 546449), 'question_id__3': 4, 'custom_input__3': None, 'user_id__3': '1', 'choice_id__3': 21, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 55, 14, 546456), 'question_id__4': 5, 'custom_input__4': None, 'user_id__4': '1', 'choice_id__4': 26, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 55, 14, 546463), 'question_id__5': 1, 'custom_input__5': None, 'user_id__5': '2', 'choice_id__5': 1, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 55, 14, 546468), 'question_id__6': 2, 'custom_input__6': None, 'user_id__6': '2', 'choice_id__6': 9, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 55, 14, 546473), 'question_id__7': 3, 'custom_input__7': None, 'user_id__7': '2', 'choice_id__7': 16, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 55, 14, 546479), 'question_id__8': 4, 'custom_input__8': None, 'user_id__8': '2', 'choice_id__8': 20, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 55, 14, 546486), 'question_id__9': 5, 'custom_input__9': None, 'user_id__9': '2', 'choice_id__9': 25, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 55, 14, 546493)}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__0': '고마움', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'user_id__1': '1', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__2': '1', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__2': '미안함', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'user_id__3': '1', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'user_id__4': '1', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__4': '사랑', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__5': '1', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__6': '1', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__6': '친밀감', 'memo__6': '너와의 대화가 편하고 좋았어.', 'user_id__7': '1', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__7': '억울함', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'user_id__8': '1', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'memo__8': '너의 반응이 조금 서운했어.', 'user_id__9': '1', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__9': '행복', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'user_id__10': '1', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'user_id__11': '1', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__11': '신뢰', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'user_id__12': '1', 'date__12': datetime.datetime(2025, 7, 7, 0, 0) ... 8 parameters truncated ... 'emotion__14': '바쁨', 'memo__14': '서로 바빠도 너를 떠올리게 됐어.', 'user_id__15': '2', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__15': '서운함', 'memo__15': '너의 반응이 조금 서운했어.', 'user_id__16': '2', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'user_id__17': '2', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__17': '이해', 'memo__17': '네 입장에서 생각해보게 됐어.', 'user_id__18': '2', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__19': '2', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__19': '호감', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'user_id__20': '2', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'memo__20': '너와 있으면 참 편안해.', 'user_id__21': '2', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__21': '기대감', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__22': '2', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'user_id__23': '2', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__23': '기쁨', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'user_id__24': '2', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'memo__24': '사소한 행동에도 감동했어.', 'user_id__25': '2', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__25': '사랑', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__26': '2', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.'}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s (insertmanyvalues) 1/1 (ordered)] {'embed_index__0': None, 'is_delivered__0': 1, 'image_url__0': None, 'couple_id__0': '1', 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'user_id__0': '1', 'has_image__0': 0, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'deleted_at__0': None, 'embed_index__1': None, 'is_delivered__1': 1, 'image_url__1': None, 'couple_id__1': '1', 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'user_id__1': '2', 'has_image__1': 0, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'deleted_at__1': None, 'embed_index__2': None, 'is_delivered__2': 1, 'image_url__2': None, 'couple_id__2': '1', 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'user_id__2': '1', 'has_image__2': 0, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'deleted_at__2': None, 'embed_index__3': None, 'is_delivered__3': 1, 'image_url__3': None, 'couple_id__3': '1', 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'user_id__3': '2', 'has_image__3': 0, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'deleted_at__3': None, 'embed_index__4': None, 'is_delivered__4': 1, 'image_url__4': None, 'couple_id__4': '1', 'content__4': '어제 약속했는데 통화 못했네 😕', 'user_id__4': '2', 'has_image__4': 0, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'deleted_at__4': None, 'embed_index__5': None, 'is_delivered__5': 1, 'image_url__5': None, 'couple_id__5': '1', 'content__5': '미안… 회의 끝나고 뻗어버렸어 ㅠ' ... 170 parameters truncated ... 'content__24': '너랑 시간 보내는 거 제일 좋아', 'user_id__24': '1', 'has_image__24': 0, 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'deleted_at__24': None, 'embed_index__25': None, 'is_delivered__25': 1, 'image_url__25': None, 'couple_id__25': '1', 'content__25': '나도야~ 🥰', 'user_id__25': '2', 'has_image__25': 0, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'deleted_at__25': None, 'embed_index__26': None, 'is_delivered__26': 1, 'image_url__26': None, 'couple_id__26': '1', 'content__26': '일주일 진짜 빠르다', 'user_id__26': '1', 'has_image__26': 0, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'deleted_at__26': None, 'embed_index__27': None, 'is_delivered__27': 1, 'image_url__27': None, 'couple_id__27': '1', 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'user_id__27': '2', 'has_image__27': 0, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'deleted_at__27': None, 'embed_index__28': None, 'is_delivered__28': 1, 'image_url__28': None, 'couple_id__28': '1', 'content__28': '너 있어서 든든했어', 'user_id__28': '1', 'has_image__28': 0, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'deleted_at__28': None, 'embed_index__29': None, 'is_delivered__29': 1, 'image_url__29': None, 'couple_id__29': '1', 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'user_id__29': '2', 'has_image__29': 0, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'deleted_at__29': None}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:15][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:44][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:55:44][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:55:44][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [generated in 0.00019s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00011s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00019s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00023s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00015s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 55, 44, 973771), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 55, 44, 973774), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 55, 44, 981524)}
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] [generated in 0.00030s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:55:44][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'user_id__0': '1', 'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 55, 44, 454525), 'custom_input__0': None, 'question_id__0': 1, 'choice_id__0': 2, 'user_id__1': '1', 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 55, 44, 454541), 'custom_input__1': None, 'question_id__1': 2, 'choice_id__1': 8, 'user_id__2': '1', 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 55, 44, 454548), 'custom_input__2': None, 'question_id__2': 3, 'choice_id__2': 13, 'user_id__3': '1', 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 55, 44, 454555), 'custom_input__3': None, 'question_id__3': 4, 'choice_id__3': 21, 'user_id__4': '1', 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 55, 44, 454562), 'custom_input__4': None, 'question_id__4': 5, 'choice_id__4': 26, 'user_id__5': '2', 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 55, 44, 454568), 'custom_input__5': None, 'question_id__5': 1, 'choice_id__5': 1, 'user_id__6': '2', 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 55, 44, 454574), 'custom_input__6': None, 'question_id__6': 2, 'choice_id__6': 9, 'user_id__7': '2', 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 55, 44, 454580), 'custom_input__7': None, 'question_id__7': 3, 'choice_id__7': 16, 'user_id__8': '2', 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 55, 44, 454586), 'custom_input__8': None, 'question_id__8': 4, 'choice_id__8': 20, 'user_id__9': '2', 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 55, 44, 454593), 'custom_input__9': None, 'question_id__9': 5, 'choice_id__9': 25}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [generated in 0.00006s (insertmanyvalues) 1/1 (ordered)] {'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'user_id__0': '1', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__0': '고마움', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__1': '1', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__1': '기대감', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'user_id__2': '1', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__2': '미안함', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'user_id__3': '1', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__3': '죄책감', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__4': '1', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__4': '사랑', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__5': '1', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__5': '다정함', 'memo__6': '너와의 대화가 편하고 좋았어.', 'user_id__6': '1', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__6': '친밀감', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'user_id__7': '1', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__7': '억울함', 'memo__8': '너의 반응이 조금 서운했어.', 'user_id__8': '1', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__8': '서운함', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'user_id__9': '1', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__9': '행복', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'user_id__10': '1', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__10': '감사', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'user_id__11': '1', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__11': '신뢰', 'memo__12': '너에 대한 애정이 넘쳤어.', 'user_id__12': '1' ... 8 parameters truncated ... 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'emotion__14': '바쁨', 'memo__15': '너의 반응이 조금 서운했어.', 'user_id__15': '2', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__15': '서운함', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'user_id__16': '2', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'emotion__16': '실망감', 'memo__17': '네 입장에서 생각해보게 됐어.', 'user_id__17': '2', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__17': '이해', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'user_id__18': '2', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'emotion__18': '다정함', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'user_id__19': '2', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__19': '호감', 'memo__20': '너와 있으면 참 편안해.', 'user_id__20': '2', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'emotion__20': '편안함', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'user_id__21': '2', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__21': '기대감', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'user_id__22': '2', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'emotion__22': '불만', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'user_id__23': '2', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__23': '기쁨', 'memo__24': '사소한 행동에도 감동했어.', 'user_id__24': '2', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'emotion__24': '감동', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'user_id__25': '2', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__25': '사랑', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'user_id__26': '2', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'emotion__26': '안정감'}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [generated in 0.00010s (insertmanyvalues) 1/1 (ordered)] {'has_image__0': 0, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'user_id__0': '1', 'image_url__0': None, 'is_delivered__0': 1, 'deleted_at__0': None, 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'embed_index__0': None, 'couple_id__0': '1', 'has_image__1': 0, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'user_id__1': '2', 'image_url__1': None, 'is_delivered__1': 1, 'deleted_at__1': None, 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'embed_index__1': None, 'couple_id__1': '1', 'has_image__2': 0, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'user_id__2': '1', 'image_url__2': None, 'is_delivered__2': 1, 'deleted_at__2': None, 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'embed_index__2': None, 'couple_id__2': '1', 'has_image__3': 0, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'user_id__3': '2', 'image_url__3': None, 'is_delivered__3': 1, 'deleted_at__3': None, 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'embed_index__3': None, 'couple_id__3': '1', 'has_image__4': 0, 'content__4': '어제 약속했는데 통화 못했네 😕', 'user_id__4': '2', 'image_url__4': None, 'is_delivered__4': 1, 'deleted_at__4': None, 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'embed_index__4': None, 'couple_id__4': '1', 'has_image__5': 0, 'content__5': '미안… 회의 끝나고 뻗어버렸어 ㅠ', 'user_id__5': '1', 'image_url__5': None, 'is_delivered__5': 1 ... 170 parameters truncated ... 'is_delivered__24': 1, 'deleted_at__24': None, 'created_at__24': datetime.datetime(2025, 7, 6, 18, 20), 'embed_index__24': None, 'couple_id__24': '1', 'has_image__25': 0, 'content__25': '나도야~ 🥰', 'user_id__25': '2', 'image_url__25': None, 'is_delivered__25': 1, 'deleted_at__25': None, 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'embed_index__25': None, 'couple_id__25': '1', 'has_image__26': 0, 'content__26': '일주일 진짜 빠르다', 'user_id__26': '1', 'image_url__26': None, 'is_delivered__26': 1, 'deleted_at__26': None, 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'embed_index__26': None, 'couple_id__26': '1', 'has_image__27': 0, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'user_id__27': '2', 'image_url__27': None, 'is_delivered__27': 1, 'deleted_at__27': None, 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'embed_index__27': None, 'couple_id__27': '1', 'has_image__28': 0, 'content__28': '너 있어서 든든했어', 'user_id__28': '1', 'image_url__28': None, 'is_delivered__28': 1, 'deleted_at__28': None, 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'embed_index__28': None, 'couple_id__28': '1', 'has_image__29': 0, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘', 'user_id__29': '2', 'image_url__29': None, 'is_delivered__29': 1, 'deleted_at__29': None, 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'embed_index__29': None, 'couple_id__29': '1'}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:55:45][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:56:09][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:09][INFO][sqlalchemy.engine.Engine] SELECT messages.chat_id AS messages_chat_id, messages.user_id AS messages_user_id, messages.couple_id AS messages_couple_id, messages.content AS messages_content, messages.image_url AS messages_image_url, messages.has_image AS messages_has_image, messages.created_at AS messages_created_at, messages.deleted_at AS messages_deleted_at, messages.is_delivered AS messages_is_delivered, messages.embed_index AS messages_embed_index 
FROM messages 
WHERE messages.couple_id = %(couple_id_1)s AND messages.user_id = %(user_id_1)s AND messages.is_delivered = false ORDER BY messages.created_at
[2025-07-13 23:56:09][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'couple_id_1': '1', 'user_id_1': '2'}
[2025-07-13 23:56:09][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:12][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '안녕', 'created_at': datetime.datetime(2025, 7, 13, 14, 56, 12, 922677), 'embed_index': None}
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] {'pk_1': 1}
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] [cached since 0.001631s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:12][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:12][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=11
[2025-07-13 23:56:14][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:56:14][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] [cached since 1.195s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '안녕하세요, 지민님! 어떻게 지내고 계신가요? 요즘 마음이 어떤지 궁금해요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 56, 14, 125863), 'embed_index': None}
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] [cached since 1.201s ago] {'pk_1': 2}
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] [cached since 1.201s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:14][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=2
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] [cached since 1.202s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] [cached since 1.204s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id_1': '1', 'role_1': 'function'}
[2025-07-13 23:56:14][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] [cached since 9.361s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:22][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] [cached since 9.36s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '여친이랑 싸웠어', 'created_at': datetime.datetime(2025, 7, 13, 14, 56, 22, 291296), 'embed_index': None}
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] [cached since 9.362s ago] {'pk_1': 3}
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] [cached since 9.362s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] [cached since 9.363s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:22][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=13
[2025-07-13 23:56:25][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:56:25][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] [cached since 12.48s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '아이고, 마음이 무겁겠어요. 어떤 일로 싸우게 되었는지, 그리고 그 상황에서 어떤 기분이 드셨는지 이야기해주시면 조금 더 도와드릴 수 있을 것 같아요.', 'created_at': datetime.datetime(2025, 7, 13, 14, 56, 25, 400573), 'embed_index': None}
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] [cached since 12.48s ago] {'pk_1': 4}
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] [cached since 12.48s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:25][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=4
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] [cached since 12.48s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] [cached since 12.48s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] [cached since 11.28s ago] {'user_id_1': '1', 'role_1': 'function'}
[2025-07-13 23:56:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] [cached since 30.3s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:43][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] [cached since 30.3s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '게임하는데 여친이 너무 못하는거야 난 이기고 싶은데 그래서 나도 모르게 화냈어', 'created_at': datetime.datetime(2025, 7, 13, 14, 56, 43, 223825), 'embed_index': None}
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] [cached since 30.3s ago] {'pk_1': 5}
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] [cached since 30.3s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] [cached since 30.3s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:43][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:43][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=15
[2025-07-13 23:56:45][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:56:45][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] [cached since 32.96s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '아, 그럴 수 있죠. 게임에서는 가끔 경쟁심이 앞서서 감정이 격해질 때가 있잖아요. 지민님이 상대방에게 미안한 마음이 든다면, 솔직하게 그 마음을 전하는 것도 좋은 방법일 것 같아요. 성격이나 수준 차이로 싸움이 생기는 건 아쉽지만, 이렇게 얘기하면서 서로 이해해가는 것이 관계에 도움이 되지 않을까 생각해요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 56, 45, 883561), 'embed_index': None}
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] [cached since 32.96s ago] {'pk_1': 6}
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] [cached since 32.96s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:45][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=6
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] [cached since 32.97s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] [cached since 32.97s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] [cached since 31.76s ago] {'user_id_1': '1', 'role_1': 'function'}
[2025-07-13 23:56:45][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] [cached since 53.02s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:05][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] [cached since 53.02s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '가능할까?', 'created_at': datetime.datetime(2025, 7, 13, 14, 57, 5, 950429), 'embed_index': None}
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] [cached since 53.02s ago] {'pk_1': 7}
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] [cached since 53.02s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] [cached since 53.02s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:05][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:05][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=17
[2025-07-13 23:57:08][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:57:08][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] [cached since 55.97s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '지민님의 진심 어린 마음을 전하면 충분히 가능할 거라고 생각해요. 솔직하게 감정을 나누면 상대방도 이해하고 받아들일 수 있을 거예요. 중요한 건 서로의 입장을 이해하려는 노력과 마음이니까요. 지민님도, 여친도 서로에 대한 애정이 있으니 잘 풀릴 수 있을 거라 믿어요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 57, 8, 906757), 'embed_index': None}
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] [cached since 55.98s ago] {'pk_1': 8}
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] [cached since 55.98s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:08][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=8
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] [cached since 55.99s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] [cached since 55.99s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] [cached since 54.78s ago] {'user_id_1': '1', 'role_1': 'function'}
[2025-07-13 23:57:08][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] [cached since 69.93s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:22][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] [cached since 69.93s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '뭐라고하면서 말하면 좋을지 알려줘', 'created_at': datetime.datetime(2025, 7, 13, 14, 57, 22, 857808), 'embed_index': None}
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] [cached since 69.93s ago] {'pk_1': 9}
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] [cached since 69.93s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] [cached since 69.93s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:22][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:22][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=19
[2025-07-13 23:57:25][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:57:25][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] [cached since 72.63s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '그럼 이렇게 시작해보면 어떨까요?\n\n"지난번에 게임 하다가 내가 조금 화를 냈던 것 같아 미안해. 사실 난 같이 즐기고 싶어서 그랬던 거였는데, 그 순간엔 이기는 것에 너무 집중했나봐. 앞으로는 우리 둘 다 즐길 수 있도록 더 신경 쓸게."\n\n이렇게 솔직하게 말하면, 여친도 지민님의 진심을 느낄 수 있을 거예요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 57, 25, 562476), 'embed_index': None}
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] [cached since 72.64s ago] {'pk_1': 10}
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] [cached since 72.64s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:25][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=10
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] [cached since 72.64s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] [cached since 72.64s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] [cached since 71.45s ago] {'user_id_1': '1', 'role_1': 'function'}
[2025-07-13 23:57:25][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:57:29][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:57:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:29][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_chat_summaries (user_id, couple_id, summary, emb_id, created_at, last_msg_id) VALUES (%(user_id)s, %(couple_id)s, %(summary)s, %(emb_id)s, %(created_at)s, %(last_msg_id)s)
[2025-07-13 23:57:29][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'user_id': '1', 'couple_id': '1', 'summary': '지민님은 여자친구와 싸운 일로 마음의 무거움을 느끼고 있습니다. 싸운 이유에 대해 AI에게 이야기를 나누며 당시의 기분을 설명하려고 했습니다. AI는 자신의 이름을 물어보는 지민님에게 "무민"이라고 소개했다가 다시 "지수"라고 답하며 지원을 제공하려고 노력하고 있습니다. 지민님이 AI와 대화하는 동안 AI는 지민님의 감정을 이해하고, 언제든지 이야기를 들어주려는 자세를 보여주고 있습니다.', 'emb_id': None, 'created_at': datetime.datetime(2025, 7, 13, 14, 57, 29, 315240), 'last_msg_id': 10}
[2025-07-13 23:57:29][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:57:29][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:57:29][INFO][sqlalchemy.engine.Engine] SELECT ai_chat_summaries.id AS ai_chat_summaries_id, ai_chat_summaries.user_id AS ai_chat_summaries_user_id, ai_chat_summaries.couple_id AS ai_chat_summaries_couple_id, ai_chat_summaries.summary AS ai_chat_summaries_summary, ai_chat_summaries.emb_id AS ai_chat_summaries_emb_id, ai_chat_summaries.created_at AS ai_chat_summaries_created_at, ai_chat_summaries.last_msg_id AS ai_chat_summaries_last_msg_id 
FROM ai_chat_summaries 
WHERE ai_chat_summaries.user_id = %(user_id_1)s ORDER BY ai_chat_summaries.created_at DESC 
 LIMIT %(param_1)s
[2025-07-13 23:57:29][INFO][sqlalchemy.engine.Engine] [cached since 76.4s ago] {'user_id_1': '1', 'param_1': 1}
[2025-07-13 23:57:29][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:58:35][INFO][faiss.loader] Loading faiss with AVX2 support.
[2025-07-13 23:58:35][INFO][faiss.loader] Successfully loaded faiss with AVX2 support.
[2025-07-13 23:58:35][INFO][faiss] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DROP DATABASE IF EXISTS test_db
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
            CREATE DATABASE IF NOT EXISTS test_db
            CHARACTER SET utf8mb4
            COLLATE utf8mb4_unicode_ci
        
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT DATABASE()
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT @@sql_mode
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] SELECT @@lower_case_table_names
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE users (
	user_id VARCHAR(255) NOT NULL, 
	name VARCHAR(255) NOT NULL, 
	email VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	birth DATETIME, 
	gender ENUM('male','female','other'), 
	PRIMARY KEY (user_id), 
	UNIQUE (email)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00010s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_questions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	code VARCHAR(255), 
	text VARCHAR(255) NOT NULL, 
	`order` INTEGER, 
	PRIMARY KEY (id), 
	UNIQUE (code)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couples (
	couple_id VARCHAR(255) NOT NULL, 
	user_1 VARCHAR(255) NOT NULL, 
	user_2 VARCHAR(255) NOT NULL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	modified_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(user_1) REFERENCES users (user_id), 
	FOREIGN KEY(user_2) REFERENCES users (user_id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE emotion_logs (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	emotion TEXT, 
	date DATETIME, 
	memo TEXT, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE weekly_solutions (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE survey_choices (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	question_id INTEGER, 
	text VARCHAR(255) NOT NULL, 
	tag VARCHAR(255), 
	PRIMARY KEY (id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE messages (
	chat_id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	content TEXT, 
	image_url TEXT, 
	has_image BOOL, 
	created_at DATETIME, 
	deleted_at DATETIME, 
	is_delivered BOOL, 
	embed_index INTEGER, 
	PRIMARY KEY (chat_id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_messages (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	role VARCHAR(20) NOT NULL, 
	content TEXT NOT NULL, 
	created_at DATETIME, 
	embed_index INTEGER, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00017s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE persona_config (
	couple_id VARCHAR(255) NOT NULL, 
	persona_name VARCHAR(255), 
	updated_at DATETIME, 
	PRIMARY KEY (couple_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] CREATE INDEX ix_persona_config_couple_id ON persona_config (couple_id)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00016s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE ai_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255) NOT NULL, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	last_msg_id INTEGER NOT NULL, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE couple_chat_summaries (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	couple_id VARCHAR(255) NOT NULL, 
	summary TEXT NOT NULL, 
	emb_id INTEGER, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(couple_id) REFERENCES couples (couple_id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00020s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] 
CREATE TABLE user_survey_responses (
	id INTEGER NOT NULL AUTO_INCREMENT, 
	user_id VARCHAR(255), 
	question_id INTEGER, 
	choice_id INTEGER, 
	custom_input TEXT, 
	submitted_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (user_id), 
	FOREIGN KEY(question_id) REFERENCES survey_questions (id), 
	FOREIGN KEY(choice_id) REFERENCES survey_choices (id)
)


[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [no key 0.00018s] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] INSERT INTO users (user_id, name, email, created_at, deleted_at, modified_at, birth, gender) VALUES (%(user_id)s, %(name)s, %(email)s, %(created_at)s, %(deleted_at)s, %(modified_at)s, %(birth)s, %(gender)s)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00016s] [{'user_id': '1', 'name': '지민', 'email': 'user1@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 58, 35, 876606), 'birth': None, 'gender': 'male'}, {'user_id': '2', 'name': '수아', 'email': 'user2@test.com', 'created_at': datetime.datetime(2025, 7, 10, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 58, 35, 876609), 'birth': None, 'gender': 'female'}]
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] INSERT INTO couples (couple_id, user_1, user_2, created_at, deleted_at, modified_at) VALUES (%(couple_id)s, %(user_1)s, %(user_2)s, %(created_at)s, %(deleted_at)s, %(modified_at)s)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00013s] {'couple_id': '1', 'user_1': '1', 'user_2': '2', 'created_at': datetime.datetime(2023, 11, 3, 0, 0), 'deleted_at': None, 'modified_at': datetime.datetime(2025, 7, 13, 14, 58, 35, 881959)}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_questions (id, code, text, `order`) VALUES (%(id)s, %(code)s, %(text)s, %(order)s)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00012s] [{'id': 1, 'code': 'relationship_value', 'text': '연애에서 내가 가장 중요하게 생각하는 가치는 무엇인가요? (가장 가까운 걸 골라주세요)', 'order': 1}, {'id': 2, 'code': 'conflict_response', 'text': '연인과 다툼이 생겼을 때 나는 어떻게 대처하나요?', 'order': 2}, {'id': 3, 'code': 'affection_style', 'text': '애정 표현은 어떤 방식이 편한가요?', 'order': 3}, {'id': 4, 'code': 'contact_frequency', 'text': '연인과의 연락 빈도는 어느 정도가 좋다고 생각하나요?', 'order': 4}, {'id': 5, 'code': 'ideal_relationship', 'text': '내가 바라는 이상적인 연애는 어떤 모습인가요?', 'order': 5}, {'id': 6, 'code': 'mood_when_down', 'text': '기분이 안 좋을 때 나는 어떻게 행동하나요?', 'order': 6}, {'id': 7, 'code': 'expressing_emotions', 'text': '연인에게 감정을 표현할 때 어떤 방식이 편한가요?', 'order': 7}, {'id': 8, 'code': 'when_resentful', 'text': '서운하거나 불편한 일이 생기면 어떻게 하나요?', 'order': 8}  ... displaying 10 of 17 total bound parameter sets ...  {'id': 16, 'code': 'love_vs_life', 'text': '연애와 개인의 삶 중 우선순위는?', 'order': 16}, {'id': 17, 'code': 'different_values_response', 'text': '연애 중, 상대방이 나와 다른 가치관을 가졌을 때 나는?', 'order': 17}]
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] INSERT INTO survey_choices (id, question_id, text, tag) VALUES (%(id)s, %(question_id)s, %(text)s, %(tag)s)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00026s] [{'id': 1, 'question_id': 1, 'text': '신뢰와 믿음', 'tag': 'trust'}, {'id': 2, 'question_id': 1, 'text': '대화와 소통', 'tag': 'communication'}, {'id': 3, 'question_id': 1, 'text': '각자의 자유와 독립성', 'tag': 'independence'}, {'id': 4, 'question_id': 1, 'text': '애정 표현과 스킨십', 'tag': 'affection'}, {'id': 5, 'question_id': 1, 'text': '유머와 함께하는 즐거움', 'tag': 'humor'}, {'id': 6, 'question_id': 1, 'text': '기타 (직접 입력)', 'tag': 'custom'}, {'id': 7, 'question_id': 2, 'text': '내가 먼저 사과하고 푼다', 'tag': 'apologize_first'}, {'id': 8, 'question_id': 2, 'text': '감정을 정리한 뒤 대화한다', 'tag': 'cool_then_talk'}  ... displaying 10 of 91 total bound parameter sets ...  {'id': 90, 'question_id': 17, 'text': '피곤할 것 같으면 그냥 거리를 둔다', 'tag': 'distances_when_difficult'}, {'id': 91, 'question_id': 17, 'text': '기타 (직접 입력)', 'tag': 'custom'}]
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] INSERT INTO user_survey_responses (user_id, question_id, choice_id, custom_input, submitted_at) VALUES (%(user_id__0)s, %(question_id__0)s, %(choice_id__0)s, %(custom_input__0)s, %(submitted_at__0)s), (%(user_id__1)s, %(question_id__1)s, %(choice_id_ ... 801 characters truncated ... put__9)s, %(submitted_at__9)s) RETURNING user_survey_responses.id, user_survey_responses.id AS id__1
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00005s (insertmanyvalues) 1/1 (ordered)] {'submitted_at__0': datetime.datetime(2025, 7, 13, 14, 58, 35, 233073), 'choice_id__0': 2, 'question_id__0': 1, 'user_id__0': '1', 'custom_input__0': None, 'submitted_at__1': datetime.datetime(2025, 7, 13, 14, 58, 35, 233089), 'choice_id__1': 8, 'question_id__1': 2, 'user_id__1': '1', 'custom_input__1': None, 'submitted_at__2': datetime.datetime(2025, 7, 13, 14, 58, 35, 233097), 'choice_id__2': 13, 'question_id__2': 3, 'user_id__2': '1', 'custom_input__2': None, 'submitted_at__3': datetime.datetime(2025, 7, 13, 14, 58, 35, 233104), 'choice_id__3': 21, 'question_id__3': 4, 'user_id__3': '1', 'custom_input__3': None, 'submitted_at__4': datetime.datetime(2025, 7, 13, 14, 58, 35, 233111), 'choice_id__4': 26, 'question_id__4': 5, 'user_id__4': '1', 'custom_input__4': None, 'submitted_at__5': datetime.datetime(2025, 7, 13, 14, 58, 35, 233117), 'choice_id__5': 1, 'question_id__5': 1, 'user_id__5': '2', 'custom_input__5': None, 'submitted_at__6': datetime.datetime(2025, 7, 13, 14, 58, 35, 233122), 'choice_id__6': 9, 'question_id__6': 2, 'user_id__6': '2', 'custom_input__6': None, 'submitted_at__7': datetime.datetime(2025, 7, 13, 14, 58, 35, 233128), 'choice_id__7': 16, 'question_id__7': 3, 'user_id__7': '2', 'custom_input__7': None, 'submitted_at__8': datetime.datetime(2025, 7, 13, 14, 58, 35, 233134), 'choice_id__8': 20, 'question_id__8': 4, 'user_id__8': '2', 'custom_input__8': None, 'submitted_at__9': datetime.datetime(2025, 7, 13, 14, 58, 35, 233145), 'choice_id__9': 25, 'question_id__9': 5, 'user_id__9': '2', 'custom_input__9': None}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] INSERT INTO emotion_logs (user_id, emotion, date, memo) VALUES (%(user_id__0)s, %(emotion__0)s, %(date__0)s, %(memo__0)s), (%(user_id__1)s, %(emotion__1)s, %(date__1)s, %(memo__1)s), (%(user_id__2)s, %(emotion__2)s, %(date__2)s, %(memo__2)s), (%(user ... 1451 characters truncated ... )s, %(emotion__26)s, %(date__26)s, %(memo__26)s) RETURNING emotion_logs.id, emotion_logs.id AS id__1
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00009s (insertmanyvalues) 1/1 (ordered)] {'emotion__0': '고마움', 'memo__0': '작은 배려 하나에도 고마운 마음이 들었어.', 'date__0': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__0': '1', 'emotion__1': '기대감', 'memo__1': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__1': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__1': '1', 'emotion__2': '미안함', 'memo__2': '너에게 미안한 마음이 계속 남았어.', 'date__2': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__2': '1', 'emotion__3': '죄책감', 'memo__3': '약속 못 지켜서 마음이 무거웠어.', 'date__3': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__3': '1', 'emotion__4': '사랑', 'memo__4': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__4': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__4': '1', 'emotion__5': '다정함', 'memo__5': '네게 더 따뜻하게 대해주고 싶었어.', 'date__5': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__5': '1', 'emotion__6': '친밀감', 'memo__6': '너와의 대화가 편하고 좋았어.', 'date__6': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__6': '1', 'emotion__7': '억울함', 'memo__7': '내 마음을 네가 몰라준 것 같아 속상했어.', 'date__7': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__7': '1', 'emotion__8': '서운함', 'memo__8': '너의 반응이 조금 서운했어.', 'date__8': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__8': '1', 'emotion__9': '행복', 'memo__9': '너랑 함께한 시간이 정말 행복했어.', 'date__9': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__9': '1', 'emotion__10': '감사', 'memo__10': '네가 있어줘서 고마운 하루였어.', 'date__10': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__10': '1', 'emotion__11': '신뢰', 'memo__11': '우리는 서로 믿고 있다는 확신이 생겼어.', 'date__11': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__11': '1', 'emotion__12': '애정', 'memo__12': '너에 대한 애정이 넘쳤어.' ... 8 parameters truncated ... 'date__14': datetime.datetime(2025, 7, 1, 0, 0), 'user_id__14': '2', 'emotion__15': '서운함', 'memo__15': '너의 반응이 조금 서운했어.', 'date__15': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__15': '2', 'emotion__16': '실망감', 'memo__16': '기대했던 만큼 반응이 없어서 실망했어.', 'date__16': datetime.datetime(2025, 7, 2, 0, 0), 'user_id__16': '2', 'emotion__17': '이해', 'memo__17': '네 입장에서 생각해보게 됐어.', 'date__17': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__17': '2', 'emotion__18': '다정함', 'memo__18': '네게 더 따뜻하게 대해주고 싶었어.', 'date__18': datetime.datetime(2025, 7, 3, 0, 0), 'user_id__18': '2', 'emotion__19': '호감', 'memo__19': '너의 말투나 행동이 참 좋았어.', 'date__19': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__19': '2', 'emotion__20': '편안함', 'memo__20': '너와 있으면 참 편안해.', 'date__20': datetime.datetime(2025, 7, 4, 0, 0), 'user_id__20': '2', 'emotion__21': '기대감', 'memo__21': '오늘은 너랑 보내는 시간이 기대됐어.', 'date__21': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__21': '2', 'emotion__22': '불만', 'memo__22': '조금만 더 신경 써줬으면 좋겠다는 생각이 들었어.', 'date__22': datetime.datetime(2025, 7, 5, 0, 0), 'user_id__22': '2', 'emotion__23': '기쁨', 'memo__23': '네가 챙겨주는 모습에 기뻤어.', 'date__23': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__23': '2', 'emotion__24': '감동', 'memo__24': '사소한 행동에도 감동했어.', 'date__24': datetime.datetime(2025, 7, 6, 0, 0), 'user_id__24': '2', 'emotion__25': '사랑', 'memo__25': '너에 대한 사랑이 더 깊어진 하루였어.', 'date__25': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__25': '2', 'emotion__26': '안정감', 'memo__26': '네가 있다는 사실만으로도 마음이 놓였어.', 'date__26': datetime.datetime(2025, 7, 7, 0, 0), 'user_id__26': '2'}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] INSERT INTO messages (user_id, couple_id, content, image_url, has_image, created_at, deleted_at, is_delivered, embed_index) VALUES (%(user_id__0)s, %(couple_id__0)s, %(content__0)s, %(image_url__0)s, %(has_image__0)s, %(created_at__0)s, %(deleted_at_ ... 5028 characters truncated ... (is_delivered__29)s, %(embed_index__29)s) RETURNING messages.chat_id, messages.chat_id AS chat_id__1
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [generated in 0.00018s (insertmanyvalues) 1/1 (ordered)] {'couple_id__0': '1', 'created_at__0': datetime.datetime(2025, 7, 1, 17, 0), 'user_id__0': '1', 'is_delivered__0': 1, 'embed_index__0': None, 'has_image__0': 0, 'deleted_at__0': None, 'image_url__0': None, 'content__0': '잘 잤어? 오늘도 힘내자! 😊', 'couple_id__1': '1', 'created_at__1': datetime.datetime(2025, 7, 1, 17, 40), 'user_id__1': '2', 'is_delivered__1': 1, 'embed_index__1': None, 'has_image__1': 0, 'deleted_at__1': None, 'image_url__1': None, 'content__1': '응 고마워~ 오늘 일정 좀 많아서 바쁠 듯해.', 'couple_id__2': '1', 'created_at__2': datetime.datetime(2025, 7, 1, 18, 20), 'user_id__2': '1', 'is_delivered__2': 1, 'embed_index__2': None, 'has_image__2': 0, 'deleted_at__2': None, 'image_url__2': None, 'content__2': '나도 회의 두 개 있어서 정신 없을 듯… 이따 끝나고 연락하자~', 'couple_id__3': '1', 'created_at__3': datetime.datetime(2025, 7, 1, 19, 0), 'user_id__3': '2', 'is_delivered__3': 1, 'embed_index__3': None, 'has_image__3': 0, 'deleted_at__3': None, 'image_url__3': None, 'content__3': '좋아! 우리 저녁엔 통화하자 :)', 'couple_id__4': '1', 'created_at__4': datetime.datetime(2025, 7, 2, 17, 0), 'user_id__4': '2', 'is_delivered__4': 1, 'embed_index__4': None, 'has_image__4': 0, 'deleted_at__4': None, 'image_url__4': None, 'content__4': '어제 약속했는데 통화 못했네 😕', 'couple_id__5': '1', 'created_at__5': datetime.datetime(2025, 7, 2, 17, 40), 'user_id__5': '1', 'is_delivered__5': 1, 'embed_index__5': None ... 170 parameters truncated ... 'embed_index__24': None, 'has_image__24': 0, 'deleted_at__24': None, 'image_url__24': None, 'content__24': '너랑 시간 보내는 거 제일 좋아', 'couple_id__25': '1', 'created_at__25': datetime.datetime(2025, 7, 6, 19, 0), 'user_id__25': '2', 'is_delivered__25': 1, 'embed_index__25': None, 'has_image__25': 0, 'deleted_at__25': None, 'image_url__25': None, 'content__25': '나도야~ 🥰', 'couple_id__26': '1', 'created_at__26': datetime.datetime(2025, 7, 7, 17, 0), 'user_id__26': '1', 'is_delivered__26': 1, 'embed_index__26': None, 'has_image__26': 0, 'deleted_at__26': None, 'image_url__26': None, 'content__26': '일주일 진짜 빠르다', 'couple_id__27': '1', 'created_at__27': datetime.datetime(2025, 7, 7, 17, 40), 'user_id__27': '2', 'is_delivered__27': 1, 'embed_index__27': None, 'has_image__27': 0, 'deleted_at__27': None, 'image_url__27': None, 'content__27': '그러게~ 우리 이번 주도 잘 버텼다', 'couple_id__28': '1', 'created_at__28': datetime.datetime(2025, 7, 7, 18, 20), 'user_id__28': '1', 'is_delivered__28': 1, 'embed_index__28': None, 'has_image__28': 0, 'deleted_at__28': None, 'image_url__28': None, 'content__28': '너 있어서 든든했어', 'couple_id__29': '1', 'created_at__29': datetime.datetime(2025, 7, 7, 19, 0), 'user_id__29': '2', 'is_delivered__29': 1, 'embed_index__29': None, 'has_image__29': 0, 'deleted_at__29': None, 'image_url__29': None, 'content__29': '다음 주도 잘 지내보자! 사랑해 😘'}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`users`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couples`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`messages`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_messages`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`persona_config`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`emotion_logs`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`weekly_solutions`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`ai_chat_summaries`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`couple_chat_summaries`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_questions`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`survey_choices`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] DESCRIBE `test_db`.`user_survey_responses`
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] [raw sql] {}
[2025-07-13 23:58:35][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00014s] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:02][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '괜찮을까 이미 화가 많이 나있어서 ', 'created_at': datetime.datetime(2025, 7, 13, 14, 59, 2, 864693), 'embed_index': None}
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] [generated in 0.00015s] {'pk_1': 1}
[2025-07-13 23:59:02][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:02][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=13
[2025-07-13 23:59:07][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:59:07][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] [cached since 4.438s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '이미 많이 화가 나 있는 상황이라면, 지민님의 진심 어린 사과가 더욱 중요해질 것 같아요. 감정을 가라앉히는 시간이 필요할 수도 있지만, 지민님의 사과를 전하고 상황을 풀기 위해 노력하는 모습 자체가 큰 의미가 있을 거예요.\n\n혹시 여친이 당장은 받아들이기 힘들 수도 있지만, 시간을 두고 천천히 다가가 보세요. 이해와 애정이 있는 한 서로에게 다가갈 기회는 항상 있을 거예요. 지민님의 진심이 그녀에게 잘 전해지길 바랄게요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 59, 7, 309934), 'embed_index': None}
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] [cached since 4.443s ago] {'pk_1': 2}
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:07][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=2
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] [generated in 0.00011s] {'user_id_1': '1', 'role_1': 'function'}
[2025-07-13 23:59:07][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] [cached since 23.89s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:26][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] [cached since 23.89s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '음.. 어렵다 그냥 같이 게임 안하는게 정답인가', 'created_at': datetime.datetime(2025, 7, 13, 14, 59, 26, 743627), 'embed_index': None}
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] [cached since 23.88s ago] {'pk_1': 3}
[2025-07-13 23:59:26][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:26][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=15
[2025-07-13 23:59:30][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:59:30][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] [cached since 27.55s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '가끔은 거리를 두는 게 더 나은 경우도 있어요. 일단 한 걸음을 물러서서 다른 활동이나 대화로 관계를 풍성하게 만들어보는 것도 방법일 수 있죠. 꼭 게임이 아니더라도 함께 즐길 수 있는 것들을 찾아보면 좋을 것 같아요. 그러다 보면 다시 자연스럽게 서로 이해하고 즐거움을 찾을 수 있을 거예요.\n\n각자에게 맞는 방법을 찾는 과정이 중요하니, 지민님의 판단이 맞다고 느끼면 그렇게 해보시는 것도 좋을 거예요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 59, 30, 414997), 'embed_index': None}
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] [cached since 27.55s ago] {'pk_1': 4}
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:30][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=4
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] [cached since 23.11s ago] {'user_id_1': '1', 'role_1': 'function'}
[2025-07-13 23:59:30][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] SELECT couples.couple_id AS couples_couple_id, couples.user_1 AS couples_user_1, couples.user_2 AS couples_user_2, couples.created_at AS couples_created_at, couples.deleted_at AS couples_deleted_at, couples.modified_at AS couples_modified_at 
FROM couples 
WHERE couples.couple_id = %(couple_id_1)s 
 LIMIT %(param_1)s
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] [cached since 43.61s ago] {'couple_id_1': '1', 'param_1': 1}
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:46][INFO][routers.ai_chat] [chat_with_persona] 요청: user_id=1, couple_id=1
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] [cached since 43.61s ago] {'user_id': '1', 'couple_id': '1', 'role': 'user', 'content': '뭐하면 좋을까?', 'created_at': datetime.datetime(2025, 7, 13, 14, 59, 46, 473493), 'embed_index': None}
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] [cached since 43.6s ago] {'pk_1': 5}
[2025-07-13 23:59:46][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:46][INFO][routers.ai_chat] [chat_with_persona] OpenAI 호출 시작: user_id=1, history_len=17
[2025-07-13 23:59:49][INFO][httpx] HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
[2025-07-13 23:59:49][INFO][routers.ai_chat] [chat_with_persona] OpenAI 응답 성공: user_id=1
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] INSERT INTO ai_messages (user_id, couple_id, role, content, created_at, embed_index) VALUES (%(user_id)s, %(couple_id)s, %(role)s, %(content)s, %(created_at)s, %(embed_index)s)
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] [cached since 46.22s ago] {'user_id': '1', 'couple_id': '1', 'role': 'assistant', 'content': '함께 산책을 하거나, 맛있는 음식을 요리해서 같이 먹는 것도 참 좋을 것 같아요. 또는 서로 좋아하는 영화를 보는 것도 좋은 시간일 수 있고요. 무엇보다 중요한 건 두 분 다 편안하게 즐길 수 있는 활동이예요. 지민님과 여친 분 두 분 모두 즐길 수 있는 것을 찾으면 더 가까워질 수 있을 거예요. 😊', 'created_at': datetime.datetime(2025, 7, 13, 14, 59, 49, 92554), 'embed_index': None}
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] COMMIT
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id, ai_messages.user_id, ai_messages.couple_id, ai_messages.role, ai_messages.content, ai_messages.created_at, ai_messages.embed_index 
FROM ai_messages 
WHERE ai_messages.id = %(pk_1)s
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] [cached since 46.22s ago] {'pk_1': 6}
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] ROLLBACK
[2025-07-13 23:59:49][INFO][routers.ai_chat] [chat_with_persona] 응답 완료: user_id=1, msg_id=6
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] BEGIN (implicit)
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] SELECT ai_messages.id AS ai_messages_id, ai_messages.user_id AS ai_messages_user_id, ai_messages.couple_id AS ai_messages_couple_id, ai_messages.role AS ai_messages_role, ai_messages.content AS ai_messages_content, ai_messages.created_at AS ai_messages_created_at, ai_messages.embed_index AS ai_messages_embed_index 
FROM ai_messages 
WHERE ai_messages.user_id = %(user_id_1)s AND ai_messages.embed_index IS NULL AND ai_messages.role != %(role_1)s ORDER BY ai_messages.created_at
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] [cached since 41.78s ago] {'user_id_1': '1', 'role_1': 'function'}
[2025-07-13 23:59:49][INFO][sqlalchemy.engine.Engine] ROLLBACK
